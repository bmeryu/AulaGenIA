<!DOCTYPE html>
<html lang="es-CL">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Campus GenIA Lab - Aula GenIA</title>
    <meta name="description" content="Explora el Campus GenIA Lab, el entorno de aprendizaje exclusivo de Aula GenIA para experimentar con herramientas de IA y construir tu propio proyecto." />
    <meta name="keywords" content="campus virtual, aprendizaje IA, proyectos IA, certificados IA, Aula GenIA" />
    <link rel="canonical" href="https://aulagenia.cl/comunidad.html" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="https://aulagenia.cl/Logo_AGIA.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --brand-teal: #14b8a6;
            --brand-blue: #3b82f6;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        .gradient-text {
            background: linear-gradient(90deg, var(--brand-teal), var(--brand-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Estilo para el placeholder del textarea */
        textarea::placeholder {
            color: #9ca3af;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- =========== HEADER / NAVEGACIÓN =========== -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center" aria-label="Página de inicio de Aula GenIA">
                <img src="https://aulagenia.cl/Logo_AGIA.png" alt="Logo de Aula GenIA" class="h-12 w-auto">
            </a>
            <div class="flex items-center gap-2 sm:gap-4">
                <a href="quienes-somos.html" class="text-gray-700 font-semibold border-2 border-gray-300 rounded-full px-3 text-xs py-2 sm:px-5 sm:text-sm hover:bg-gray-100 hover:border-gray-400 transition-colors duration-300 hidden md:flex items-center">
                    Quiénes Somos
                </a>
                <a href="cursos.html" class="text-teal-600 font-semibold border-2 border-teal-500 rounded-full px-3 text-xs py-2 sm:px-5 sm:text-sm hover:bg-teal-500 hover:text-white transition-colors duration-300 flex items-center">
                    Ver Cursos
                </a>
                <!-- El botón de acceso se actualizará con JS si el usuario está logueado -->
                <div id="auth-container">
                    <a href="acceso.html" class="cta-button bg-gray-900 text-white font-bold rounded-full hover:bg-gray-700 px-4 py-1.5 sm:px-6 sm:py-2 flex flex-col items-center justify-center">
                        <span class="text-sm sm:text-base leading-tight">🔓 Acceso</span>
                        <span class="text-[9px] sm:text-[10px] font-normal opacity-75 leading-tight">Inicia tu viaje</span>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <!-- =========== CONTENIDO PRINCIPAL =========== -->
    <main>
        <!-- Hero Section -->
        <section class="container mx-auto px-6 py-16 md:py-24 text-center">
            <div class="max-w-4xl mx-auto">
                <h1 class="text-4xl md:text-6xl font-black leading-tight mb-4">
                    Te damos la bienvenida al <span class="gradient-text">🧪 Campus GenIA Lab</span>
                </h1>
                <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">
                    Es el entorno de aprendizaje exclusivo de Aula GenIA, donde cada estudiante puede experimentar, aplicar herramientas de inteligencia artificial y construir su propio proyecto final.
                </p>
            </div>
        </section>

        <!-- Sección de Características del Campus -->
        <section class="container mx-auto px-6 pb-16 md:pb-24">
            <div class="max-w-5xl mx-auto bg-white p-8 rounded-2xl shadow-lg border border-gray-200">
                <p class="text-center text-gray-600 mb-8">Nuestra filosofía de "aprender haciendo" cobra vida aquí. Es nuestro entorno de aprendizaje exclusivo donde la teoría se encuentra con la práctica.</p>
                <div class="grid md:grid-cols-3 gap-8 text-center">
                    <div class="flex flex-col items-center"><i data-lucide="flask-conical" class="h-12 w-12 text-teal-500 mb-3"></i><h3 class="font-bold text-lg">Experimentación</h3><p class="text-sm text-gray-600">Un espacio seguro para probar, equivocarse y descubrir el potencial de la herramienta sin miedo.</p></div>
                    <div class="flex flex-col items-center"><i data-lucide="target" class="h-12 w-12 text-blue-500 mb-3"></i><h3 class="font-bold text-lg">Aplicación</h3><p class="text-sm text-gray-600">Enfocamos el aprendizaje en desafíos y proyectos del mundo real para un impacto inmediato.</p></div>
                    <div class="flex flex-col items-center"><i data-lucide="blocks" class="h-12 w-12 text-gray-600 mb-3"></i><h3 class="font-bold text-lg">Construcción</h3><p class="text-sm text-gray-600">El objetivo final es que construyas tu propio proyecto, aplicando todo lo aprendido de forma tangible.</p></div>
                </div>
            </div>
        </section>

        <!-- Sección de Contenido del Blog/Foro -->
        <section class="container mx-auto px-6 max-w-5xl pb-24">
            <div class="grid lg:grid-cols-3 gap-12">
                <!-- Columna Principal: Posts -->
                <div class="lg:col-span-2">
                    <h2 class="text-2xl font-bold mb-6 border-b pb-3">Actividad Reciente en el Lab</h2>

                    <!-- INICIO: SECCIÓN PARA CREAR PUBLICACIÓN (SOLO PARA USUARIOS LOGUEADOS) -->
                    <div id="create-post-container" class="hidden mb-8">
                        <div class="bg-white p-5 rounded-xl shadow-md">
                            <div class="flex items-start gap-4">
                                <img id="user-avatar" src="" alt="Tu avatar" class="w-12 h-12 rounded-full">
                                <div class="w-full">
                                    <form id="create-post-form">
                                        <textarea id="post-content" class="w-full p-3 border-gray-200 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-shadow" rows="3" placeholder="¿Qué estás pensando, [Nombre de Usuario]?"></textarea>
                                        <div class="flex justify-end mt-3">
                                            <button type="submit" class="bg-teal-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-teal-600 transition-colors">Publicar</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- FIN: SECCIÓN PARA CREAR PUBLICACIÓN -->

                    <!-- INICIO: LLAMADA A LA ACCIÓN PARA INICIAR SESIÓN (SOLO PARA VISITANTES) -->
                    <div id="login-prompt" class="hidden mb-8">
                         <div class="bg-teal-50 border-l-4 border-teal-500 p-4 rounded-r-lg">
                            <div class="flex">
                                <div class="py-1"><i data-lucide="log-in" class="h-6 w-6 text-teal-500 mr-4"></i></div>
                                <div>
                                    <p class="font-bold text-teal-800">Únete a la conversación</p>
                                    <p class="text-sm text-teal-700"><a href="acceso.html" class="underline font-semibold">Inicia sesión</a> o <a href="acceso.html" class="underline font-semibold">regístrate</a> para publicar en el Lab.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- FIN: LLAMADA A LA ACCIÓN -->
                    
                    <div id="post-feed" class="space-y-8">
                        <!-- Las publicaciones de Firestore se cargarán aquí -->
                        <div id="feed-loader" class="text-center py-8">
                           <p class="text-gray-500">Cargando actividad...</p>
                        </div>
                    </div>
                </div>

                <!-- Columna Lateral: Categorías y CTA -->
                <aside>
                    <div class="bg-white p-6 rounded-xl shadow-md sticky top-28">
                        <h3 class="text-lg font-bold mb-4 border-b pb-2">Categorías</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="flex items-center text-gray-600 hover:text-teal-600"><i data-lucide="book-open" class="h-4 w-4 mr-2"></i>Tutoriales</a></li>
                            <li><a href="#" class="flex items-center text-gray-600 hover:text-teal-600"><i data-lucide="message-square" class="h-4 w-4 mr-2"></i>Discusiones</a></li>
                            <li><a href="#" class="flex items-center text-gray-600 hover:text-teal-600"><i data-lucide="lightbulb" class="h-4 w-4 mr-2"></i>Proyectos</a></li>
                        </ul>

                        <div id="sidebar-cta-container">
                             <a href="acceso.html" class="mt-8 block w-full bg-teal-500 text-white text-center font-bold py-3 px-4 rounded-lg hover:bg-teal-600 transition-colors">
                                Únete para Publicar
                            </a>
                        </div>
                    </div>
                </aside>
            </div>
        </section>
    </main>
    
    <!-- =========== FOOTER =========== -->
    <footer class="bg-white border-t border-gray-200">
        <div class="container mx-auto px-6 py-8 text-center text-gray-600">
            <a href="index.html" class="flex items-center justify-center mb-2">
                <img src="https://aulagenia.cl/Logo_AGIA.png" alt="Logo de Aula GenIA al pie de página" class="h-12 w-auto">
            </a>
            <p class="text-sm">&copy; 2024 - Todos los derechos reservados. Creado con 💙 y un poquito de IA.</p>
        </div>
    </footer>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js" defer></script>

    <script>
        lucide.createIcons();
        
        document.addEventListener('DOMContentLoaded', () => {
            // --- Configuración de Firebase ---
            const firebaseConfig = {
                 apiKey: "AIzaSyC9sVJwEfFdIN4VmSMooAoQLXYl5Mcu1yM", 
                 authDomain: "aulagenia.firebaseapp.com", 
                 projectId: "aulagenia", 
                 storageBucket: "aulagenia.appspot.com", 
                 messagingSenderId: "173328075630", 
                 appId: "1:173328075630:web:825606db4271ea1e66cf7f"
            };
            
            // --- Inicialización de Firebase ---
            try {
                firebase.initializeApp(firebaseConfig);
            } catch(e) {
                console.warn("Firebase ya ha sido inicializado.");
            }

            const auth = firebase.auth();
            const db = firebase.firestore();

            // --- Referencias a elementos del DOM ---
            const createPostContainer = document.getElementById('create-post-container');
            const loginPrompt = document.getElementById('login-prompt');
            const userAvatar = document.getElementById('user-avatar');
            const postContentTextarea = document.getElementById('post-content');
            const createPostForm = document.getElementById('create-post-form');
            const postFeed = document.getElementById('post-feed');
            const feedLoader = document.getElementById('feed-loader');
            const authContainer = document.getElementById('auth-container');
            const sidebarCtaContainer = document.getElementById('sidebar-cta-container');
            
            let postsListener = null; // Variable para mantener la referencia al listener

            // --- Lógica de Autenticación ---
            auth.onAuthStateChanged(user => {
                if (postsListener) {
                    postsListener(); // Detener el listener anterior para evitar duplicados
                    postsListener = null;
                }

                if (user) {
                    // --- Usuario Autenticado ---
                    loginPrompt.classList.add('hidden');
                    createPostContainer.classList.remove('hidden');

                    const userName = user.displayName || 'Alumno';
                    const userPhoto = user.photoURL || `https://placehold.co/48x48/14b8a6/FFFFFF?text=${userName.charAt(0).toUpperCase()}`;
                    
                    userAvatar.src = userPhoto;
                    postContentTextarea.placeholder = `¿Qué estás pensando, ${userName}?`;
                    
                    authContainer.innerHTML = `<a href="campus-curso-ia.html" class="text-teal-600 font-semibold border-2 border-teal-500 rounded-full px-5 text-sm py-2 hover:bg-teal-500 hover:text-white transition-colors duration-300 flex items-center">Mi Campus</a>`;
                    sidebarCtaContainer.innerHTML = `<a href="campus-curso-ia.html" class="mt-8 block w-full bg-gray-800 text-white text-center font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors">Ir a mi Curso</a>`;
                    
                    // --- Lógica para Cargar el Feed de Publicaciones (AHORA DENTRO DEL IF) ---
                    postsListener = db.collection('labPosts').orderBy('createdAt', 'desc')
                      .onSnapshot(snapshot => {
                          feedLoader.classList.add('hidden');
                          postFeed.innerHTML = ''; // Limpiar el feed para evitar duplicados
                          if (snapshot.empty) {
                              postFeed.innerHTML = '<p class="text-center text-gray-500">Aún no hay publicaciones. ¡Sé el primero en compartir algo!</p>';
                              return;
                          }
                          snapshot.forEach(doc => {
                              const post = doc.data();
                              const postDate = post.createdAt ? post.createdAt.toDate().toLocaleDateString('es-CL', { day: 'numeric', month: 'long' }) : 'Ahora mismo';

                              const postElement = document.createElement('article');
                              postElement.className = 'bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300';
                              postElement.innerHTML = `
                                    <div class="flex items-start gap-4">
                                        <img src="${post.authorAvatar}" alt="Avatar de ${post.authorName}" class="w-10 h-10 rounded-full">
                                        <div class="w-full">
                                            <div class="flex items-center justify-between mb-2">
                                                <p class="font-semibold text-sm">${post.authorName}</p>
                                                <span class="text-xs text-gray-500">${postDate}</span>
                                            </div>
                                            <p class="text-gray-700 whitespace-pre-wrap">${post.content}</p>
                                             <div class="flex items-center text-gray-500 mt-4 text-sm">
                                                <i data-lucide="message-square" class="h-4 w-4 mr-2"></i>
                                                <span>${post.commentsCount} comentarios</span>
                                            </div>
                                        </div>
                                    </div>`;
                              postFeed.appendChild(postElement);
                          });
                          lucide.createIcons();
                      }, err => {
                        console.error("Error al obtener las publicaciones: ", err);
                        feedLoader.classList.add('hidden');
                        postFeed.innerHTML = '<p class="text-center text-red-500">No se pudo cargar la actividad. Intenta recargar la página.</p>';
                      });

                } else {
                    // --- Usuario No Autenticado ---
                    createPostContainer.classList.add('hidden');
                    loginPrompt.classList.remove('hidden');
                    authContainer.innerHTML = `<a href="acceso.html" class="cta-button bg-gray-900 text-white font-bold rounded-full hover:bg-gray-700 px-4 py-1.5 sm:px-6 sm:py-2 flex flex-col items-center justify-center"><span class="text-sm sm:text-base leading-tight">🔓 Acceso</span><span class="text-[9px] sm:text-[10px] font-normal opacity-75 leading-tight">Inicia tu viaje</span></a>`;
                    sidebarCtaContainer.innerHTML = `<a href="acceso.html" class="mt-8 block w-full bg-teal-500 text-white text-center font-bold py-3 px-4 rounded-lg hover:bg-teal-600 transition-colors">Únete para Publicar</a>`;
                    
                    feedLoader.classList.add('hidden');
                    postFeed.innerHTML = '<p class="text-center text-gray-500 py-8">Inicia sesión para ver y crear publicaciones.</p>';
                }
                 lucide.createIcons();
            });

            // --- Lógica para Crear Publicaciones ---
            createPostForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const content = postContentTextarea.value.trim();
                const user = auth.currentUser;

                if (content && user) {
                    db.collection('labPosts').add({
                        content: content,
                        authorName: user.displayName || 'Alumno',
                        authorId: user.uid,
                        authorAvatar: user.photoURL || `https://placehold.co/40x40/14b8a6/FFFFFF?text=${(user.displayName || 'A').charAt(0).toUpperCase()}`,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        commentsCount: 0
                    }).then(() => {
                        postContentTextarea.value = '';
                    }).catch(err => {
                        console.error("Error al añadir la publicación: ", err);
                        alert("Hubo un error al publicar. Por favor, inténtalo de nuevo.");
                    });
                }
            });
        });
    </script>
</body>
</html>
