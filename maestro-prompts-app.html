<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGIA Command Center | Studio v4.0</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --brand-primary: #6366f1;
            --brand-secondary: #a855f7;
            --bg-dark: #09090b;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #fcfcfd; 
            color: #1e293b;
            -webkit-font-smoothing: antialiased;
        }
        
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Premium Shadows & Borders */
        .premium-card {
            background: var(--card-bg);
            border: 1px solid rgba(0,0,0,0.06);
            box-shadow: 0 1px 3px rgba(0,0,0,0.02), 0 10px 40px -10px rgba(0,0,0,0.04);
            border-radius: 24px;
        }

        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }

        /* AGIA Tag Micro-Architecture */
        .hl-tag { 
            padding: 2px 8px; 
            border-radius: 6px; 
            margin: 0 1px; 
            font-weight: 600; 
            font-size: 0.9em; 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            border: 1px solid transparent;
        }
        
        .hl-active { 
            transform: translateY(-1px) scale(1.02); 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); 
            border-color: rgba(0,0,0,0.1);
        }

        .hl-rol { color: #2563eb; background: #eff6ff; border-color: #dbeafe; }
        .hl-contexto { color: #059669; background: #ecfdf5; border-color: #d1fae5; }
        .hl-meta { color: #d97706; background: #fffbeb; border-color: #fef3c7; }
        .hl-restricciones { color: #dc2626; background: #fef2f2; border-color: #fee2e2; }
        .hl-formato { color: #7c3aed; background: #f5f3ff; border-color: #ede9fe; }

        .var-highlight { 
            background: #f0f9ff;
            color: #0284c7;
            border-bottom: 2px solid #0ea5e9;
            padding: 0 4px;
            font-weight: 700;
            border-radius: 2px;
        }

        /* Ambient Backgrounds */
        .bg-grid {
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 24px 24px;
        }

        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .animate-pulse-soft { animation: pulse-soft 3s infinite; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-grid">

    <!-- Global Nav -->
    <header class="h-16 flex-none bg-white/80 backdrop-blur-xl border-b border-slate-200/60 z-50 flex items-center justify-between px-8">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-black rounded-lg flex items-center justify-center shadow-lg">
                    <span class="text-white font-black text-sm">A</span>
                </div>
                <div class="h-8 w-px bg-slate-200"></div>
                <div>
                    <h1 class="text-sm font-bold text-slate-900 tracking-tight">AGIA Lab <span class="text-indigo-600">Studio</span></h1>
                    <p class="text-[10px] text-slate-400 font-medium uppercase tracking-[0.2em]">Framework Engineering v4.0</p>
                </div>
            </div>
        </div>
        
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 bg-slate-100 px-3 py-1.5 rounded-full border border-slate-200">
                <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                <span class="text-[10px] font-bold text-slate-600 uppercase tracking-wider">Engine: Gemini 1.5 Pro</span>
            </div>
            <button class="bg-indigo-600 hover:bg-indigo-700 text-white h-9 px-4 rounded-xl text-xs font-bold transition-all shadow-lg shadow-indigo-100 flex items-center gap-2">
                <span class="material-symbols-rounded text-sm">rocket_launch</span>
                Upgrade to Pro
            </button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <!-- Case Sidebar -->
        <aside class="w-80 flex flex-col bg-white border-r border-slate-200/60 z-40">
            <div class="p-6">
                <div class="relative group">
                    <span class="material-symbols-rounded absolute left-3.5 top-2.5 text-slate-400 text-lg group-focus-within:text-indigo-600 transition-colors">search</span>
                    <input type="text" id="searchInput" placeholder="Search prompts..." 
                        class="w-full pl-11 pr-4 py-2.5 bg-slate-100 border-none rounded-2xl text-xs font-medium focus:ring-2 focus:ring-indigo-500/10 transition-all outline-none"
                        onkeyup="filterCases()">
                </div>
            </div>

            <!-- Categories Filter (Horizontal Pills) -->
            <div class="px-6 mb-4 overflow-x-auto no-scrollbar flex gap-2" id="category-nav"></div>

            <div class="flex-1 overflow-y-auto custom-scroll px-3 space-y-1" id="case-list"></div>
            
            <div class="p-6 border-t border-slate-100">
                <div class="flex items-center justify-between text-[11px] font-bold text-slate-400 mb-2">
                    <span>SYSTEM HEALTH</span>
                    <span class="text-emerald-500">OPTIMAL</span>
                </div>
                <div class="h-1 w-full bg-slate-100 rounded-full overflow-hidden">
                    <div class="h-full w-4/5 bg-emerald-500 rounded-full"></div>
                </div>
            </div>
        </aside>

        <!-- Workbench Main Area -->
        <main class="flex-1 flex flex-col bg-[#fcfcfd] overflow-hidden">
            
            <!-- Empty State -->
            <div id="workspace-empty" class="hidden flex-col items-center justify-center h-full text-center p-12">
                <div class="w-24 h-24 bg-white rounded-3xl shadow-xl flex items-center justify-center mb-6">
                    <span class="material-symbols-rounded text-5xl text-slate-200">dashboard_customize</span>
                </div>
                <h3 class="text-xl font-bold text-slate-900 mb-2">Workbench Empty</h3>
                <p class="text-sm text-slate-400 max-w-sm mx-auto">Select a prompt template from the sidebar to begin your architectural analysis.</p>
            </div>

            <!-- Active Workbench -->
            <div id="case-detail" class="flex-1 overflow-y-auto custom-scroll p-8 lg:p-12">
                <div class="max-w-[1400px] mx-auto fade-in">
                    
                    <!-- Top Workbench Info -->
                    <div class="flex items-end justify-between mb-10 pb-8 border-b border-slate-200/60">
                        <div class="space-y-4">
                            <span id="detail-category-badge" class="px-3 py-1 rounded-full bg-indigo-50 text-indigo-600 text-[10px] font-bold uppercase tracking-[0.15em] border border-indigo-100">Category</span>
                            <h2 id="detail-title" class="text-4xl font-extrabold text-slate-900 tracking-tight leading-none">Prompt Case</h2>
                            <p id="detail-problem" class="text-base text-slate-500 max-w-3xl leading-relaxed"></p>
                        </div>
                        
                        <div class="flex gap-3">
                            <button class="h-10 px-4 rounded-xl border border-slate-200 text-xs font-bold text-slate-600 hover:bg-white transition-colors flex items-center gap-2">
                                <span class="material-symbols-rounded text-sm">history</span>
                                Versions
                            </button>
                            <button id="copy-btn" onclick="copyPrompt()" class="h-10 px-6 rounded-xl bg-slate-900 text-white text-xs font-bold hover:bg-black transition-all shadow-xl shadow-slate-200 flex items-center gap-2">
                                <span class="material-symbols-rounded text-sm">content_copy</span>
                                Deploy Code
                            </button>
                        </div>
                    </div>

                    <!-- Layout: Customization & Comparison Grid -->
                    <div class="grid lg:grid-cols-12 gap-10">
                        
                        <!-- Columna Variables (Config) -->
                        <div class="lg:col-span-3">
                            <div class="premium-card p-6 sticky top-0">
                                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6 flex items-center gap-2">
                                    <span class="material-symbols-rounded text-base text-indigo-600">tune</span>
                                    Configuration
                                </h3>
                                <div id="variables-container" class="space-y-6"></div>
                                
                                <!-- Engineer Stats Mockup -->
                                <div class="mt-8 pt-8 border-t border-slate-100 space-y-4">
                                    <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Quality Metrics</h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between text-[11px] font-medium">
                                            <span class="text-slate-500">Syntactic Clarity</span>
                                            <span class="text-emerald-600">98%</span>
                                        </div>
                                        <div class="flex justify-between text-[11px] font-medium">
                                            <span class="text-slate-500">Hallucination Risk</span>
                                            <span class="text-rose-500">Low</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Columna COMPARISON VIEW -->
                        <div class="lg:col-span-9 space-y-8">
                            
                            <!-- COMPONENT: THE SPLIT WORKBENCH -->
                            <div class="grid md:grid-cols-2 gap-6 h-[600px]">
                                
                                <!-- LEFT: AMATEUR / LEGACY -->
                                <div class="flex flex-col bg-white border border-slate-200 rounded-[32px] overflow-hidden group hover:border-slate-300 transition-colors">
                                    <div class="p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 rounded-md bg-slate-200 flex items-center justify-center">
                                                <span class="material-symbols-rounded text-xs text-slate-500">error_outline</span>
                                            </div>
                                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Amateur Method</span>
                                        </div>
                                    </div>
                                    <div class="p-6 flex-1 flex flex-col gap-6 overflow-hidden">
                                        <div>
                                            <label class="text-[9px] font-black text-slate-400 uppercase mb-3 block tracking-widest">Prompt Input</label>
                                            <div id="bad-prompt-rendered" class="text-sm text-slate-500 bg-slate-50 p-5 rounded-2xl border border-dashed border-slate-300 italic font-mono leading-relaxed"></div>
                                        </div>
                                        <div class="flex-1 flex flex-col overflow-hidden">
                                            <label class="text-[9px] font-black text-slate-400 uppercase mb-3 block tracking-widest">IA Response Preview</label>
                                            <div id="bad-result-preview" class="text-xs text-slate-400 leading-relaxed p-5 bg-white border border-slate-100 rounded-2xl flex-1 overflow-y-auto custom-scroll shadow-inner"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- RIGHT: PROFESSIONAL AGIA -->
                                <div class="flex flex-col bg-white border-2 border-indigo-600 rounded-[32px] overflow-hidden shadow-[0_20px_60px_-15px_rgba(99,102,241,0.15)] relative">
                                    <div class="p-6 border-b border-indigo-50 flex items-center justify-between bg-indigo-600">
                                        <div class="flex items-center gap-2 text-white">
                                            <div class="w-6 h-6 rounded-md bg-white/20 flex items-center justify-center">
                                                <span class="material-symbols-rounded text-xs">auto_awesome</span>
                                            </div>
                                            <span class="text-[10px] font-black uppercase tracking-widest">Neural Engineering AGIA</span>
                                        </div>
                                        <span class="text-[10px] font-bold text-indigo-200 bg-white/10 px-2 py-0.5 rounded uppercase">Mastery High</span>
                                    </div>
                                    <div class="p-6 flex-1 flex flex-col gap-6 overflow-hidden">
                                        <div class="flex-none">
                                            <label class="text-[9px] font-black text-indigo-400 uppercase mb-3 block tracking-widest">Architectural Matrix</label>
                                            <div id="detail-prompt-rendered" class="font-mono text-[13px] leading-relaxed text-slate-700 bg-slate-900 text-slate-300 p-6 rounded-2xl min-h-[180px] max-h-[250px] overflow-y-auto custom-scroll shadow-2xl border border-white/5"></div>
                                        </div>

                                        <!-- Interactive Neural Map (Legend) -->
                                        <div id="interactive-legend" class="flex flex-wrap gap-2 pt-2 border-t border-slate-50">
                                            <span class="legend-item cursor-pointer flex items-center gap-1.5 text-[9px] font-bold text-slate-400 hover:text-indigo-600 transition-colors" data-type="r"><span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span> Role</span>
                                            <span class="legend-item cursor-pointer flex items-center gap-1.5 text-[9px] font-bold text-slate-400 hover:text-indigo-600 transition-colors" data-type="c"><span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span> Context</span>
                                            <span class="legend-item cursor-pointer flex items-center gap-1.5 text-[9px] font-bold text-slate-400 hover:text-indigo-600 transition-colors" data-type="m"><span class="w-1.5 h-1.5 rounded-full bg-amber-500"></span> Meta</span>
                                            <span class="legend-item cursor-pointer flex items-center gap-1.5 text-[9px] font-bold text-slate-400 hover:text-indigo-600 transition-colors" data-type="l"><span class="w-1.5 h-1.5 rounded-full bg-red-500"></span> Constraints</span>
                                        </div>

                                        <div class="flex-1 flex flex-col overflow-hidden mt-2">
                                            <label class="text-[9px] font-black text-indigo-400 uppercase mb-3 block tracking-widest">Projected Output</label>
                                            <div id="good-result-preview" class="text-xs text-slate-600 leading-relaxed p-5 bg-white border border-indigo-100/50 rounded-2xl flex-1 overflow-y-auto custom-scroll shadow-inner font-medium"></div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 z-50 transition-all duration-500 translate-y-24 opacity-0">
        <div class="bg-black text-white px-8 py-4 rounded-3xl shadow-2xl flex items-center gap-4 border border-white/10 backdrop-blur-md">
            <span class="material-symbols-rounded text-emerald-400">task_alt</span>
            <span class="text-xs font-bold uppercase tracking-widest">Code Deployed to Clipboard</span>
        </div>
    </div>

    <!-- Logic Engine -->
    <script type="module">
        let casesData = [];
        const externalDBUrl = 'https://aulagenia.cl/prompts_db.js';
        
        async function loadDatabase() {
            try {
                const module = await import(`${externalDBUrl}?t=${new Date().getTime()}`);
                if (module?.default) {
                    casesData = module.default;
                    initApp();
                }
            } catch (err) {
                console.error("Critical Engine Failure:", err);
            }
        }

        loadDatabase();

        let currentPromptTemplate = "";
        let currentBadPromptTemplate = "";
        let currentVariables = {};

        function initApp() {
            window.loadCase = loadCase;
            window.filterCases = filterCases;
            window.updateVariable = updateVariable;
            window.copyPrompt = copyPrompt;
            window.filterByCategory = (cat) => renderList(casesData.filter(c => c.category === cat));

            renderCategories();
            renderList(casesData);
            setupLegendInteractions();
            if(casesData[0]) loadCase(casesData[0].id);
        }

        function loadCase(id) {
            const c = casesData.find(x => x.id === id);
            if(!c) return;

            document.querySelectorAll('.case-item').forEach(el => el.classList.remove('bg-indigo-50', 'border-indigo-100', 'active-case'));
            const activeEl = document.getElementById(`case-item-${id}`);
            if(activeEl) activeEl.classList.add('bg-indigo-50', 'border-indigo-100', 'active-case');

            document.getElementById('workspace-empty').classList.add('hidden');
            document.getElementById('case-detail').classList.remove('hidden');

            document.getElementById('detail-title').innerText = c.title;
            document.getElementById('detail-problem').innerText = c.problem;
            document.getElementById('bad-result-preview').innerHTML = c.badResponsePreview;
            document.getElementById('good-result-preview').innerHTML = c.previewResponse;
            document.getElementById('detail-category-badge').innerText = c.category;

            currentPromptTemplate = c.agiaPromptTagged;
            currentBadPromptTemplate = c.badPromptDynamic || c.badPrompt;
            currentVariables = {};
            
            const regex = /{([a-z0-9_]+)\|([^}]+)}/g;
            let match;
            const varsFound = [];
            while ((match = regex.exec(currentPromptTemplate)) !== null) {
                varsFound.push({ key: match[1], default: match[2] });
                currentVariables[match[1]] = match[2];
            }

            renderVariables(varsFound);
            renderPrompts();
        }

        function renderVariables(vars) {
            const container = document.getElementById('variables-container');
            container.innerHTML = vars.length ? '' : '<p class="text-[10px] text-slate-400 italic font-medium">Static template. No parameters required.</p>';
            
            vars.forEach(v => {
                const div = document.createElement('div');
                div.className = "space-y-2";
                div.innerHTML = `
                    <label class="block text-[9px] font-black uppercase text-slate-400 pl-1 tracking-widest">${v.key.replace(/_/g, ' ')}</label>
                    <input type="text" value="${v.default}" oninput="updateVariable('${v.key}', this.value)"
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-xs font-bold text-slate-700 focus:bg-white focus:ring-2 focus:ring-indigo-500/10 transition-all outline-none">
                `;
                container.appendChild(div);
            });
        }

        function updateVariable(key, val) {
            currentVariables[key] = val;
            renderPrompts();
        }

        function renderPrompts() {
            let renderedAgia = currentPromptTemplate;
            Object.keys(currentVariables).forEach(key => {
                const val = currentVariables[key] || "...";
                const regex = new RegExp(`{${key}\\|[^}]+}`, 'g');
                renderedAgia = renderedAgia.replace(regex, `<span class="var-highlight">${val}</span>`);
            });

            const tags = { r: 'rol', c: 'contexto', m: 'meta', l: 'restricciones', f: 'formato' };
            Object.keys(tags).forEach(t => {
                const regex = new RegExp(`{${t}}(.*?){/${t}}`, 'gs');
                renderedAgia = renderedAgia.replace(regex, `<span class="hl-tag hl-${tags[t]}" data-tag-type="${t}">$1</span>`);
            });
            document.getElementById('detail-prompt-rendered').innerHTML = renderedAgia.replace(/\n/g, '<br>');

            let renderedBad = currentBadPromptTemplate;
            Object.keys(currentVariables).forEach(key => {
                const regex = new RegExp(`{${key}}`, 'g');
                renderedBad = renderedBad.replace(regex, `<span class="var-highlight-bad">${currentVariables[key]}</span>`);
            });
            document.getElementById('bad-prompt-rendered').innerHTML = `"${renderedBad}"`;
        }

        function setupLegendInteractions() {
            const legend = document.getElementById('interactive-legend');
            legend.addEventListener('mouseover', (e) => {
                const item = e.target.closest('.legend-item');
                if(!item) return;
                document.querySelectorAll(`.hl-tag[data-tag-type="${item.dataset.type}"]`).forEach(el => el.classList.add('hl-active'));
            });
            legend.addEventListener('mouseout', (e) => {
                const item = e.target.closest('.legend-item');
                if(!item) return;
                document.querySelectorAll(`.hl-tag[data-tag-type="${item.dataset.type}"]`).forEach(el => el.classList.remove('hl-active'));
            });
        }

        function copyPrompt() {
            navigator.clipboard.writeText(document.getElementById('detail-prompt-rendered').innerText);
            const toast = document.getElementById('toast');
            toast.classList.remove('translate-y-24', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-24', 'opacity-0'), 3000);
        }

        function renderCategories() {
            const cats = ["productivity", "finance", "sales", "tech", "education"];
            document.getElementById('category-nav').innerHTML = cats.map(c => `
                <button onclick="filterByCategory('${c}')" class="px-4 py-1.5 bg-white border border-slate-200 rounded-full text-[10px] font-black uppercase tracking-widest text-slate-500 hover:border-indigo-500 transition-all flex-none">${c}</button>
            `).join('');
        }

        function renderList(cases) {
            const list = document.getElementById('case-list');
            document.getElementById('total-display').innerText = `${cases.length} TEMPLATES`;
            list.innerHTML = cases.map(c => `
                <div id="case-item-${c.id}" onclick="loadCase(${c.id})" class="case-item p-4 rounded-2xl cursor-pointer border border-transparent hover:bg-slate-50 transition-all group flex items-center gap-4 mb-1">
                    <div class="w-10 h-10 rounded-xl bg-white border border-slate-200 flex items-center justify-center text-slate-400 group-hover:text-indigo-600 group-hover:border-indigo-100 shadow-sm transition-all">
                        <span class="material-symbols-rounded text-xl">token</span>
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <h4 class="text-[12px] font-bold text-slate-700 truncate group-hover:text-slate-900">${c.title}</h4>
                        <div class="flex items-center gap-2 mt-1">
                             <span class="text-[9px] text-slate-400 uppercase font-black tracking-widest">${c.category}</span>
                             <span class="w-1 h-1 rounded-full bg-slate-300"></span>
                             <span class="text-[9px] text-emerald-500 font-bold">READY</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterCases() {
            const s = document.getElementById('searchInput').value.toLowerCase();
            renderList(casesData.filter(c => c.title.toLowerCase().includes(s)));
        }
    </script>
</body>
</html>
