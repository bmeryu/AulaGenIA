<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√≥veda de Prompts AGIA 2.0 | Oferta Black Friday</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts & Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        .blur-locked { filter: blur(4px); user-select: none; pointer-events: none; }
        
        /* Highlight Classes for Prompts - AGIA 2.0 SYSTEM */
        .hl-rol { background-color: #bfdbfe; color: #1e3a8a; padding: 2px 6px; border-radius: 4px; font-weight: 600; border: 1px solid #60a5fa; }
        .hl-contexto { background-color: #a7f3d0; color: #064e3b; padding: 2px 6px; border-radius: 4px; font-weight: 600; border: 1px solid #34d399; }
        .hl-ejemplos { background-color: #fcd34d; color: #92400e; padding: 2px 6px; border-radius: 4px; font-weight: 600; border: 1px solid #f59e0b; }
        .hl-meta { background-color: #fde68a; color: #78350f; padding: 2px 6px; border-radius: 4px; font-weight: 600; border: 1px solid #fbbf24; }
        .hl-limites { background-color: #fecaca; color: #7f1d1d; padding: 2px 6px; border-radius: 4px; font-weight: 600; border: 1px solid #f87171; }
        .hl-formato { background-color: #e9d5ff; color: #581c87; padding: 2px 6px; border-radius: 4px; font-weight: 600; border: 1px solid #a855f7; }
        .hl-validacion { background-color: #bbf7d0; color: #14532d; padding: 2px 6px; border-radius: 4px; font-weight: 600; border: 1px solid #22c55e; }

        .prose-sm p { margin-bottom: 0.8em; line-height: 1.6; }
        .prose-sm ul, .prose-sm ol { margin-left: 1.2em; margin-bottom: 0.8em; }
        .prose-sm li { margin-bottom: 0.4em; }
        
        /* Tooltip Styles */
        .tooltip-trigger:hover .tooltip-content { display: block; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden text-slate-800 bg-slate-100">

    <!-- Header "Brand" Style (Violeta/Azul) -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-600 shadow-lg z-20 flex-none relative text-white">
        <div class="max-w-[1920px] mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-2">
            <!-- Top Row: Logo & CTA -->
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-4">
                    <!-- Logo AGIA -->
                    <img src="https://aulagenia.cl/Logo_AGIA.png" alt="Logo AGIA" class="h-12 w-auto object-contain brightness-0 invert filter drop-shadow-md">
                    <div class="border-l border-white/20 pl-4 hidden sm:block">
                        <h1 class="text-lg font-bold tracking-tight leading-tight">B√≥veda de Prompts AGIA 2.0</h1>
                        <p class="text-[11px] text-indigo-100 font-medium opacity-90">Framework Avanzado de Ingenier√≠a de Prompts</p>
                    </div>
                </div>
                <!-- Bot√≥n Compra Header -->
                <button onclick="openPaywall()" class="hidden md:flex bg-yellow-400 hover:bg-yellow-300 text-indigo-900 px-4 py-1.5 rounded-full text-xs font-bold shadow-md transition-all items-center gap-2 transform hover:scale-105">
                    <span class="material-symbols-outlined text-sm">lock_open</span>
                    DESBLOQUEAR TODO
                </button>
            </div>

            <!-- Category Navigation (Pills) -->
            <div class="overflow-x-auto custom-scroll pb-2 -mx-4 px-4 md:mx-0 md:px-0">
                <div class="flex space-x-3 min-w-max" id="category-nav">
                    <!-- Injected by JS -->
                </div>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="flex flex-1 overflow-hidden max-w-[1920px] mx-auto w-full relative bg-slate-100">
        
        <!-- Sidebar -->
        <aside class="w-full md:w-80 flex flex-col bg-white border-r border-slate-200 flex-none z-10 transition-all duration-300 absolute md:relative h-full transform -translate-x-full md:translate-x-0 shadow-xl md:shadow-none" id="sidebar">
            <div class="p-4 border-b border-slate-100 bg-white sticky top-0 z-10">
                <div class="relative">
                    <span class="material-symbols-outlined absolute left-3 top-2.5 text-slate-400 text-lg">search</span>
                    <input type="text" id="searchInput" placeholder="Buscar prompt..." 
                        class="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
                        onkeyup="filterCases()">
                </div>
            </div>
            <div class="flex-1 overflow-y-auto custom-scroll p-3 space-y-2" id="case-list">
                <!-- Cases injected by JS -->
            </div>
            <div class="p-3 border-t border-slate-100 text-xs text-center text-slate-400 bg-slate-50">
                B√≥veda cargada con <span id="count-display" class="font-bold">0</span> prompts
            </div>
        </aside>

        <!-- Mobile Toggle -->
        <button onclick="toggleSidebar()" class="md:hidden absolute bottom-6 left-6 z-40 bg-indigo-600 text-white p-4 rounded-full shadow-lg hover:bg-indigo-700 transition-colors flex items-center justify-center">
            <span class="material-symbols-outlined">menu_open</span>
        </button>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col bg-slate-50 overflow-hidden relative w-full">
            
            <!-- Case Detail -->
            <div id="case-detail" class="flex-1 overflow-y-auto custom-scroll p-4 md:p-8 pb-24">
                <div class="max-w-5xl mx-auto fade-in">
                    
                    <!-- Title Header -->
                    <div class="flex items-center gap-4 mb-6 border-b border-slate-200 pb-6">
                        <div id="detail-icon-bg" class="w-12 h-12 md:w-16 md:h-16 rounded-2xl flex items-center justify-center border-2 bg-white shadow-sm">
                            <span id="detail-icon" class="material-symbols-outlined text-3xl"></span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span id="detail-category-badge" class="text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-full border">Categor√≠a</span>
                                <span id="detail-verified-badge" class="text-[10px] font-medium text-slate-400 flex items-center gap-1 bg-white px-2 py-0.5 rounded border border-slate-100">
                                    <span class="material-symbols-outlined text-[10px] text-green-500">verified</span> Estructura AGIA 2.0
                                </span>
                            </div>
                            <h2 id="detail-title" class="text-2xl md:text-3xl font-bold text-slate-800 leading-tight">T√≠tulo del Caso</h2>
                            <p id="detail-problem" class="text-sm text-slate-500 mt-1 font-medium"></p>
                        </div>
                    </div>

                    <!-- AGIA 2.0 LEGEND (Top Bar) -->
                    <div id="agia-legend" class="mb-6 bg-white rounded-xl border border-slate-200 shadow-sm p-1 flex overflow-x-auto">
                        <div class="flex-1 flex items-center justify-center py-2 border-r border-slate-100 gap-2 min-w-[90px]">
                            <div class="w-5 h-5 rounded bg-blue-100 text-blue-600 flex items-center justify-center text-[10px] font-bold">1</div>
                            <span class="text-[10px] font-bold uppercase text-slate-500 tracking-wide">Rol</span>
                        </div>
                        <div class="flex-1 flex items-center justify-center py-2 border-r border-slate-100 gap-2 min-w-[90px]">
                            <div class="w-5 h-5 rounded bg-emerald-100 text-emerald-600 flex items-center justify-center text-[10px] font-bold">2</div>
                            <span class="text-[10px] font-bold uppercase text-slate-500 tracking-wide">Contexto</span>
                        </div>
                        <div class="flex-1 flex items-center justify-center py-2 border-r border-slate-100 gap-2 min-w-[90px]">
                            <div class="w-5 h-5 rounded bg-yellow-100 text-yellow-700 flex items-center justify-center text-[10px] font-bold">3</div>
                            <span class="text-[10px] font-bold uppercase text-slate-500 tracking-wide">Ejemplos</span>
                        </div>
                        <div class="flex-1 flex items-center justify-center py-2 border-r border-slate-100 gap-2 min-w-[90px]">
                            <div class="w-5 h-5 rounded bg-amber-100 text-amber-600 flex items-center justify-center text-[10px] font-bold">4</div>
                            <span class="text-[10px] font-bold uppercase text-slate-500 tracking-wide">Meta</span>
                        </div>
                        <div class="flex-1 flex items-center justify-center py-2 border-r border-slate-100 gap-2 min-w-[90px]">
                            <div class="w-5 h-5 rounded bg-red-100 text-red-600 flex items-center justify-center text-[10px] font-bold">5</div>
                            <span class="text-[10px] font-bold uppercase text-slate-500 tracking-wide">L√≠mites</span>
                        </div>
                        <div class="flex-1 flex items-center justify-center py-2 border-r border-slate-100 gap-2 min-w-[90px]">
                            <div class="w-5 h-5 rounded bg-purple-100 text-purple-600 flex items-center justify-center text-[10px] font-bold">6</div>
                            <span class="text-[10px] font-bold uppercase text-slate-500 tracking-wide">Formato</span>
                        </div>
                        <div class="flex-1 flex items-center justify-center py-2 gap-2 min-w-[90px]">
                            <div class="w-5 h-5 rounded bg-green-100 text-green-600 flex items-center justify-center text-[10px] font-bold">7</div>
                            <span class="text-[10px] font-bold uppercase text-slate-500 tracking-wide">Validaci√≥n</span>
                        </div>
                    </div>

                    <!-- PROMPT BOX (HERO) -->
                    <div id="main-box" class="bg-slate-900 rounded-2xl shadow-xl mb-8 border border-slate-700 relative transition-all duration-300">
                        <!-- Decorative Glow -->
                        <div id="box-glow" class="absolute top-0 left-1/2 transform -translate-x-1/2 w-2/3 h-1 bg-gradient-to-r from-transparent via-indigo-500 to-transparent opacity-70"></div>
                        
                        <!-- Header Prompt Box -->
                        <div id="box-header" class="bg-slate-800/50 px-6 py-4 flex justify-between items-center border-b border-slate-700/50 rounded-t-2xl">
                            <div class="flex items-center gap-2">
                                <span id="box-header-icon" class="material-symbols-outlined text-yellow-400 text-base">auto_awesome</span>
                                <span id="box-header-text" class="text-xs font-bold text-slate-300 tracking-widest uppercase">Prompt Maestro</span>
                            </div>
                            
                            <div class="flex items-center gap-4">
                                <!-- Suggested AI Badge -->
                                <div id="ai-badge-container" class="hidden md:block"></div>
                                
                                <!-- Copy Button -->
                                <button id="box-actions" onclick="copyPrompt()" class="flex items-center gap-2 text-xs bg-slate-700 hover:bg-slate-600 text-white px-4 py-1.5 rounded-lg font-bold transition-all border border-slate-600">
                                    <span class="material-symbols-outlined text-sm">content_copy</span> 
                                    <span>COPIAR</span>
                                </button>
                            </div>
                        </div>

                        <!-- Content Prompt Box -->
                        <div id="box-content-area" class="p-6 md:p-8 relative bg-slate-900/50 rounded-b-2xl">
                            <!-- Mobile AI Badge -->
                            <div id="ai-badge-mobile" class="md:hidden mb-6"></div>
                            
                            <div id="detail-prompt-rendered" class="font-mono text-sm md:text-base leading-loose text-slate-300 select-all">...</div>
                        </div>
                    </div>

                    <!-- COMPARISON GRID -->
                    <div id="comparison-container" class="grid md:grid-cols-2 gap-6">
                        
                        <!-- Bad Prompt & Bad Result -->
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col gap-4">
                            <div>
                                <h3 class="text-[10px] font-bold text-slate-400 uppercase mb-3 flex items-center gap-1 tracking-wider">
                                    <span class="material-symbols-outlined text-base text-red-400">close</span> Lo que escribe la mayor√≠a
                                </h3>
                                <div class="bg-slate-50 p-4 rounded-lg border border-slate-100 text-sm text-slate-500 italic font-mono">
                                    <p id="detail-bad-prompt">"..."</p>
                                </div>
                            </div>

                            <div class="pt-4 border-t border-slate-100">
                                <h3 class="text-[10px] font-bold text-slate-400 uppercase mb-2 flex items-center gap-1 tracking-wider">
                                    <span class="material-symbols-outlined text-base text-slate-400">output</span> Resultado T√≠pico (Sin AGIA)
                                </h3>
                                <div class="text-xs text-slate-600 leading-relaxed bg-slate-50/50 p-3 rounded border border-slate-100">
                                     <p id="detail-bad-result">...</p>
                                </div>
                            </div>

                            <div class="flex flex-wrap gap-2 mt-auto" id="deficiency-badges"></div>
                        </div>

                        <!-- Result Preview (Good) -->
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col">
                            <h3 class="text-[10px] font-bold text-slate-400 uppercase mb-3 flex items-center gap-1 tracking-wider">
                                <span class="material-symbols-outlined text-base text-indigo-500">check_circle</span> Resultado AGIA (Optimizado)
                            </h3>
                            <div class="overflow-x-auto flex-1">
                                <div id="preview-response" class="text-xs text-slate-700 prose-sm bg-indigo-50/30 p-4 rounded-lg border border-indigo-100 h-full">
                                    <!-- JS injects preview here -->
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>
    <!-- PAYWALL MODAL -->
    <div id="paywall-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm transition-opacity" onclick="closePaywall()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
            <div class="bg-white rounded-2xl shadow-2xl overflow-hidden relative animate-in fade-in zoom-in duration-300">
                <button onclick="closePaywall()" class="absolute top-3 right-3 text-slate-400 hover:text-slate-600 bg-white rounded-full p-1 z-10">
                    <span class="material-symbols-outlined">close</span>
                </button>
                
                <div class="bg-slate-900 p-8 text-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-40 h-40 bg-indigo-600 rounded-full blur-3xl opacity-30 -mr-10 -mt-10"></div>
                    <span class="material-symbols-outlined text-5xl text-yellow-400 mb-2 relative z-10">lock</span>
                    <h3 class="text-white font-bold text-xl relative z-10">Contenido Premium</h3>
                    <p class="text-indigo-200 text-sm relative z-10">Este prompt es parte de la B√≥veda Privada.</p>
                    <div class="mt-4 relative z-10">
                        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 text-left">
                            <p class="text-white text-xs font-bold mb-1">‚ú® Con acceso Premium obtienes:</p>
                            <ul class="text-indigo-100 text-xs space-y-1 ml-4">
                                <li>‚Ä¢ 100+ prompts AGIA 2.0 con ejemplos</li>
                                <li>‚Ä¢ Casos avanzados (encadenamiento, debugging)</li>
                                <li>‚Ä¢ Actualizaciones mensuales sin costo</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="p-6 text-center">
                    <p class="text-slate-600 text-sm mb-6">
                        Est√°s viendo la versi√≥n gratuita. Accede a los <span class="font-bold text-slate-900">100+ casos avanzados</span> y copia mis f√≥rmulas validadas.
                    </p>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-6">
                        <p class="text-xs font-bold text-yellow-800 uppercase tracking-wide">üî• Oferta Black Friday</p>
                        <p class="text-2xl font-black text-slate-900">$9.990 <span class="text-sm font-normal text-slate-500 line-through">$19.990</span></p>
                        <p class="text-[10px] text-slate-500">Pago √∫nico. Acceso de por vida.</p>
                    </div>

                    <a id="payment-btn" href="#" target="_blank" class="block w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 hover:scale-[1.02] transition-all shadow-lg shadow-indigo-200 mb-3 flex items-center justify-center gap-2">
                        <span>DESBLOQUEAR B√ìVEDA AHORA</span>
                        <span class="material-symbols-outlined text-sm">arrow_forward</span>
                    </a>
                    
                    <p class="text-[10px] text-slate-400">Garant√≠a de satisfacci√≥n. Pago seguro v√≠a Mercado Pago.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- WELCOME MODAL (AGIA 2.0) -->
    <div id="welcome-modal" class="fixed inset-0 z-[70] hidden">
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm transition-opacity"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl p-4 max-h-[90vh] overflow-y-auto">
            <div class="bg-white rounded-2xl shadow-2xl overflow-hidden relative">
                <button onclick="closeWelcome()" class="absolute top-3 right-3 text-slate-400 hover:text-slate-600 bg-white rounded-full p-1 z-10 shadow-md">
                    <span class="material-symbols-outlined">close</span>
                </button>
                
                <div class="bg-gradient-to-br from-indigo-600 to-purple-600 p-8 text-center relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full opacity-10">
                        <div class="absolute top-10 left-10 w-20 h-20 bg-white rounded-full"></div>
                        <div class="absolute bottom-10 right-10 w-32 h-32 bg-white rounded-full"></div>
                    </div>
                    <span class="material-symbols-outlined text-6xl text-white mb-3 relative z-10">auto_awesome</span>
                    <h2 class="text-white font-bold text-3xl mb-2 relative z-10">¬°Bienvenido a AGIA 2.0!</h2>
                    <p class="text-indigo-100 text-sm relative z-10">La evoluci√≥n del sistema de prompts m√°s efectivo</p>
                </div>

                <div class="p-8">
                    <div class="mb-6">
                        <h3 class="text-lg font-bold text-slate-800 mb-3 flex items-center gap-2">
                            <span class="material-symbols-outlined text-indigo-600">upgrade</span>
                            ¬øQu√© hay de nuevo?
                        </h3>
                        <div class="space-y-3">
                            <div class="flex gap-3 items-start">
                                <div class="w-8 h-8 rounded-lg bg-yellow-100 flex items-center justify-center flex-none">
                                    <span class="material-symbols-outlined text-yellow-600 text-lg">lightbulb</span>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-slate-700">EJEMPLOS (Few-shot Learning)</p>
                                    <p class="text-xs text-slate-500">Ahora cada prompt incluye ejemplos de entrada/salida esperada para resultados m√°s precisos</p>
                                </div>
                            </div>
                            <div class="flex gap-3 items-start">
                                <div class="w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center flex-none">
                                    <span class="material-symbols-outlined text-green-600 text-lg">check_circle</span>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-slate-700">VALIDACI√ìN</p>
                                    <p class="text-xs text-slate-500">Criterios de √©xito medibles para verificar que la respuesta cumple tus expectativas</p>
                                </div>
                            </div>
                            <div class="flex gap-3 items-start">
                                <div class="w-8 h-8 rounded-lg bg-rose-100 flex items-center justify-center flex-none">
                                    <span class="material-symbols-outlined text-rose-600 text-lg">psychology</span>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-slate-700">T√âCNICAS AVANZADAS</p>
                                    <p class="text-xs text-slate-500">Nueva categor√≠a con anti-patrones, encadenamiento de prompts, control de alucinaciones y m√°s</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-50 rounded-xl p-4 mb-6">
                        <p class="text-xs text-slate-600 mb-2"><strong>Estructura AGIA 2.0 (7 componentes):</strong></p>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                                <span>1. Rol</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                                <span>2. Contexto</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-yellow-500"></span>
                                <span>3. Ejemplos üÜï</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                                <span>4. Meta</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-red-500"></span>
                                <span>5. L√≠mites</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-purple-500"></span>
                                <span>6. Formato</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-green-500"></span>
                                <span>7. Validaci√≥n üÜï</span>
                            </div>
                        </div>
                    </div>

                    <div class="text-center">
                        <button onclick="closeWelcome()" class="bg-indigo-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-lg inline-flex items-center gap-2">
                            Empezar a explorar
                            <span class="material-symbols-outlined text-lg">arrow_forward</span>
                        </button>
                        <p class="text-xs text-slate-400 mt-3">Puedes volver a ver esto desde el men√∫ de ayuda</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURACI√ìN DE VENTA
        // ==========================================
        const LINK_MERCADO_PAGO = "#"; 
        document.getElementById('payment-btn').href = LINK_MERCADO_PAGO;

        // --- HELPERS PARA AGIA 2.0 MARKUP ---
        function renderAGIA(text) {
            let html = text
                .replace(/{r}(.*?){\/r}/g, '<span class="hl-rol" title="ROL: ¬øQui√©n act√∫a?">$1</span>')
                .replace(/{c}(.*?){\/c}/g, '<span class="hl-contexto" title="CONTEXTO: Antecedentes y archivos">$1</span>')
                .replace(/{e}(.*?){\/e}/g, '<span class="hl-ejemplos" title="EJEMPLOS: Few-shot learning">$1</span>')
                .replace(/{m}(.*?){\/m}/g, '<span class="hl-meta" title="META: Objetivo principal">$1</span>')
                .replace(/{l}(.*?){\/l}/g, '<span class="hl-limites" title="LIMITES: Restricciones y reglas">$1</span>')
                .replace(/{f}(.*?){\/f}/g, '<span class="hl-formato" title="FORMATO: Estructura de salida">$1</span>')
                .replace(/{v}(.*?){\/v}/g, '<span class="hl-validacion" title="VALIDACI√ìN: Criterios de √©xito">$1</span>')
                .replace(/\n/g, '<br>');
            return html;
        }

        function cleanAGIA(text) {
            return text
                .replace(/{[rcemlfv]}/g, '')
                .replace(/{\/[rcemlfv]}/g, '')
                .replace(/<br\s*\/?>/gi, '\n')
                .replace(/&nbsp;/g, ' ')
                .replace(/<\/?[^>]+(>|$)/g, "");
        }

        // --- CONFIGURACI√ìN DE IAs ---
        const aiConfig = {
            chatgpt: { name: "ChatGPT", bg: "bg-indigo-600", icon: "bolt" }, 
            gemini: { name: "Gemini", bg: "bg-blue-600", icon: "psychology" },
            midjourney: { name: "Midjourney", bg: "bg-fuchsia-600", icon: "palette" },
            claude: { name: "Claude", bg: "bg-orange-600", icon: "auto_awesome" }
        };

        // --- DATA ENGINE ---
        const categoryConfig = {
            office: { label: "Oficina & Excel", color: "emerald", icon: "table_view" },
            finance: { label: "Finanzas & Dinero", color: "amber", icon: "attach_money" }, 
            marketing: { label: "Marketing & RRSS", color: "pink", icon: "campaign" },
            creativity: { label: "Creatividad & Arte", color: "lime", icon: "lightbulb" }, 
            personal: { label: "Vida & Hogar", color: "orange", icon: "home" },
            tech: { label: "Tecnolog√≠a & C√≥digo", color: "violet", icon: "terminal" },
            education: { label: "Educaci√≥n", color: "cyan", icon: "school" },
            advanced: { label: "T√©cnicas Avanzadas", color: "rose", icon: "psychology" },
            tools: { label: "Tus Herramientas", color: "slate", icon: "construction" }
        };

        // Update createCase to accept difficulty level
        const createCase = (id, cat, title, icon, problem, badPrompt, badResPreview, goodPromptTagged, goodResPreview, suggestedAI, locked = false, deficiencies = [], isTool = false, difficulty = 'beginner') => ({
            id, category: cat, title, icon, problem, 
            badPrompt, 
            badResponsePreview: badResPreview,
            agiaPromptTagged: goodPromptTagged, 
            previewResponse: goodResPreview,
            suggestedAI: suggestedAI, 
            locked: locked, 
            deficiencies: deficiencies.length ? deficiencies : ["Sin Rol", "Contexto Vago"],
            isTool: isTool,
            difficulty: difficulty
        });

        // --- BASE DE DATOS DE PROMPTS AGIA 2.0 ---
        const allCases = [
            
            // --- T√âCNICAS AVANZADAS (NUEVA CATEGOR√çA) ---
            
            createCase(801, 'advanced', 'Anti-Patr√≥n: Prompt Ambiguo', 'warning', 'Qu√© NO hacer al pedir ayuda con IA', 
                'Ay√∫dame con Excel.',
                'Claro, ¬øqu√© necesitas hacer en Excel? (Se pierde 1 minuto esperando aclaraci√≥n)', 
                '{r}Act√∫a como Ingeniero de Datos.{/r} {c}Tengo 3 columnas: Ventas (columna A), Fecha (columna B), y Vendedor (columna C) con 500 filas de datos del √∫ltimo a√±o.{/c} {e}EJEMPLO DE MIS DATOS:\nA1: $50.000 | B1: 01/01/2024 | C1: Juan\nA2: $75.000 | B2: 05/01/2024 | C2: Mar√≠a{/e} {m}Necesito:\n1. Crear una tabla din√°mica que muestre ventas totales por vendedor\n2. Filtrar solo los datos del √∫ltimo trimestre (Oct-Dic 2024)\n3. Ordenar de mayor a menor{/m} {l}- Versi√≥n Excel 2021 para Windows\n- Sin macros, solo funcionalidad nativa{/l} {f}Dame los pasos numerados con capturas de men√∫ (Alt + teclas) para crear la tabla.{/f} {v}‚úì Debe mostrarme c√≥mo seleccionar el rango correcto\n‚úì Los pasos deben ser reproducibles sin conocimiento previo{/v}', 
                '<p class="text-xs font-bold mb-2">Pasos para crear Tabla Din√°mica:</p><ol class="list-decimal ml-4 text-xs space-y-1"><li>Selecciona todo el rango (A1:C501): <strong>Ctrl + Shift + Fin</strong></li><li>Men√∫: <strong>Alt ‚Üí N ‚Üí V</strong> (Insertar ‚Üí Tabla Din√°mica)</li><li>Arrastra "Vendedor" a Filas y "Ventas" a Valores</li><li>Haz clic en "Fecha" ‚Üí Filtro ‚Üí "Este trimestre"</li><li>Clic derecho en columna Ventas ‚Üí Ordenar ‚Üí Mayor a menor</li></ol><p class="text-xs mt-2"><strong>‚úì Resultado:</strong> Ver√°s algo como: Juan: $500.000 / Mar√≠a: $450.000</p>', 
                'gemini', false, ["Sin Contexto", "P√©rdida de Tiempo"], false, 'intermediate'),

            createCase(802, 'advanced', 'Encadenamiento de Prompts', 'link', 'Para proyectos complejos, divide en etapas', 
                'Analiza este informe financiero, crea gr√°ficos y escr√≠beme un resumen ejecutivo de todo.',
                'Respuesta superficial que toca todo pero sin profundidad en ning√∫n tema', 
                '{r}Act√∫a como CFO (Director Financiero).{/r} {c}Adjunto informe financiero Q3 2024 con Estado de Resultados y Balance.{/c} {m}PASO 1 (AN√ÅLISIS): Identifica los 3 hallazgos m√°s cr√≠ticos en estos datos. Enf√≥cate solo en:\n- M√°rgenes operacionales vs a√±o anterior\n- Flujo de caja operativo\n- Ratio de liquidez actual{/m} {l}Ignora por ahora notas al pie y anexos. Solo cifras principales.{/l} {f}Lista de 3 hallazgos con:\n- Hallazgo\n- Cifra exacta\n- Variaci√≥n % vs per√≠odo anterior{/f} {v}‚úì Cada hallazgo debe tener una cifra verificable\n‚úì Debe se√±alar si es positivo o preocupante{/v}', 
                '<p class="text-xs font-bold mb-2">üéØ VENTAJA DEL ENCADENAMIENTO:</p><ul class="list-disc ml-4 text-xs space-y-1 mb-3"><li><strong>Profundidad:</strong> Cada etapa se construye sobre resultados verificados</li><li><strong>Control:</strong> Puedes corregir el rumbo entre pasos</li><li><strong>Especializaci√≥n:</strong> Cada prompt usa el "rol" √≥ptimo para esa tarea</li></ul><p class="text-xs font-bold mb-1">Luego contin√∫a con PASO 2 (Gr√°ficos) y PASO 3 (Memo ejecutivo)</p>', 
                'chatgpt', false, ["Prompt √önico Gigante", "Superficial en Todo"], false, 'advanced'),

            createCase(803, 'advanced', 'Refinamiento Iterativo', 'refresh', 'C√≥mo mejorar respuestas insatisfactorias', 
                'El texto que me generaste est√° muy largo y formal.',
                'Ok, aqu√≠ est√° m√°s corto: [Versi√≥n resumida gen√©rica sin criterios claros]', 
                '{r}Act√∫a como Editor Senior de Revista.{/r} {c}Este es el texto que generaste anteriormente:\n\n[PEGAR TEXTO ORIGINAL QUE NO TE GUST√ì]{/c} {m}Regenera el contenido aplicando estos cambios ESPEC√çFICOS:\n1. Reduce de 500 a 200 palabras m√°ximo\n2. Cambia el tono de "formal acad√©mico" a "conversacional pero profesional"\n3. A√±ade 2 ejemplos concretos del mundo real\n4. Convierte las frases pasivas en activas{/m} {e}ANTES (Pasiva/Formal): "Los resultados fueron analizados..."\nDESPU√âS (Activa/Conversacional): "Analic√© los resultados y descubr√≠ que..."{/e} {l}- Mant√©n los datos estad√≠sticos exactos del original\n- No inventes nuevos hechos\n- Conserva la estructura de 3 p√°rrafos{/l} {f}Texto reescrito seguido de:\n\n**CHANGELOG:**\n- ‚úì Reducido a [X] palabras\n- ‚úì Tono ajustado: [ejemplo de frase antes/despu√©s]\n- ‚úì Ejemplos a√±adidos: [cu√°les]{/f} {v}‚úì Debe pasar test de legibilidad grado 8 o menos\n‚úì Al menos 2 oraciones deben empezar con "Imagina..." o "Piensa en..."{/v}', 
                '<p class="text-xs font-bold mb-2">üîÑ T√âCNICA DE REFINAMIENTO:</p><ol class="list-decimal ml-4 text-xs space-y-2 mb-3"><li><strong>Especifica QU√â cambiar:</strong> No digas "mejor", di "m√°s corto/m√°s ejemplos/menos formal"</li><li><strong>Usa referencias:</strong> "Como estilo Malcolm Gladwell"</li><li><strong>Pide changelog:</strong> Obliga a la IA a explicar qu√© modific√≥</li><li><strong>Iteraci√≥n 2-3 veces:</strong> El primer refinamiento rara vez es perfecto</li></ol>', 
                'claude', false, ["Feedback Vago", "Sin Criterios Medibles"], false, 'advanced'),

            createCase(804, 'advanced', 'Control de Alucinaciones', 'fact_check', 'C√≥mo obtener respuestas verificables', 
                '¬øCu√°nto cuesta un Tesla Model 3 en Chile?',
                'Un Tesla Model 3 en Chile cuesta aproximadamente $35.000.000 seg√∫n informaci√≥n reciente. (INVENTADO)', 
                '{r}Act√∫a como Investigador de Mercado que SOLO reporta fuentes primarias.{/r} {c}Necesito conocer el precio actual de venta del Tesla Model 3 versi√≥n base en Chile.{/c} {m}Busca en:\n1. Sitio oficial Tesla Chile\n2. Automotoras certificadas Tesla\n3. Si NO encuentras informaci√≥n actualizada, responde "No dispongo de datos verificables de [mes/a√±o]"{/m} {l}PROHIBIDO:\n- Usar frases como "aproximadamente", "se estima"\n- Inventar cifras\n- Citar "fuentes" gen√©ricas sin URL\n\nOBLIGATORIO:\n- Incluir fecha de la informaci√≥n\n- Citar URL exacta\n- Si hay variaciones, separarlas{/l} {f}FORMATO:\n\n**Tesla Model 3 [Versi√≥n]:** $XX.XXX.XXX CLP\n**Fuente:** [URL exacta]\n**Fecha verificada:** [MM/YYYY]\n**Notas:** [Si incluye/excluye algo]{/f} {v}‚úì La URL debe ser clickeable y existir\n‚úì Si dices "No disponible", sugerir m√©todo alternativo{/v}', 
                '<p class="text-xs font-bold mb-2">üõ°Ô∏è ESTRATEGIAS ANTI-ALUCINACI√ìN:</p><ul class="list-disc ml-4 text-xs space-y-1 mb-3"><li><strong>Exige fuentes:</strong> "Cita la URL donde encontraste esto"</li><li><strong>Pide fecha:</strong> "¬øDe cu√°ndo es este dato?"</li><li><strong>Valora la honestidad:</strong> "Si no sabes, di \'No s√©\'"</li><li><strong>Cross-check:</strong> Pregunta lo mismo de 2 formas distintas</li></ul><p class="text-xs bg-red-50 p-2 rounded border border-red-200"><strong>‚ö†Ô∏è Regla de oro:</strong> Si la IA usa "probablemente", "creo que" ‚Üí Es alucinaci√≥n potencial</p>', 
                'chatgpt', false, ["Acepta Estimaciones", "Sin Fuentes"], false, 'advanced'),

            createCase(805, 'advanced', 'Extracci√≥n de Datos Estructurados', 'code', 'Convertir texto ca√≥tico en tablas', 
                'Convierte esto en una tabla: Juan vendi√≥ 5 laptops el lunes. Mar√≠a hizo 3 ventas de tablets el martes.',
                'Tabla markdown b√°sica sin estructura clara ni manejo de casos edge', 
                '{r}Act√∫a como Parser de Datos Estructurados.{/r} {c}Texto fuente (extracto de emails):\n\n"Juan vendi√≥ 5 laptops HP el lunes 4 de dic. Mar√≠a cerr√≥ 3 tablets Samsung el martes. El mi√©rcoles Pedro no vendi√≥ nada por estar enfermo."{/c} {e}INPUT (texto desordenado):\n"Ana compr√≥ 10kg manzanas por $5.000 el 1/12"\n\nOUTPUT ESPERADO (JSON):\n```json\n{\n  "comprador": "Ana",\n  "producto": "Manzanas",\n  "cantidad": 10,\n  "precio": 5000,\n  "fecha": "2024-12-01"\n}\n```{/e} {m}Extrae TODA la informaci√≥n del texto y genera un JSON v√°lido.{/m} {l}REGLAS:\n- Si falta un dato, pon `null`\n- Convierte fechas a formato ISO\n- Si alguien no vendi√≥, cantidad = 0\n- El JSON debe ser copy-pasteable{/l} {f}```json\n[TU RESPUESTA AQU√ç]\n```\n\n**VALIDACI√ìN:** Debe parsear en jsonlint.com{/f} {v}‚úì Debe parsear sin errores\n‚úì Debe tener exactamente 3 objetos\n‚úì El campo observaciones de Pedro debe decir "Enfermo"{/v}', 
                '<p class="text-xs font-bold mb-2">üìä CASOS DE USO:</p><ul class="list-disc ml-4 text-xs"><li>Parsear facturas</li><li>Extraer datos de contratos PDF</li><li>Convertir emails en CRM entries</li></ul>', 
                'claude', false, ["Formato Humano", "No Procesable"], false, 'advanced'),

            createCase(806, 'advanced', 'Prompts Multimodales', 'image', 'Combinar imagen + texto efectivamente', 
                '[Sube foto de pizarra] ¬øQu√© dice esto?',
                'Es un diagrama con flechas y texto borroso. No logro leer bien algunas partes.', 
                '{r}Act√∫a como Asistente de Reuniones que transcribe pizarras.{/r} {c}Adjunto foto de pizarra tomada al final de nuestra sesi√≥n de brainstorming sobre arquitectura del sistema.{/c} {e}CONTEXTO DE LA REUNI√ìN:\n- Tema: Migraci√≥n de monolito a microservicios\n- Participantes: 3 devs backend + 1 arquitecto\n- Objetivo: Definir qu√© servicios separar primero{/e} {m}De la imagen:\n1. Identifica todos los bloques\n2. Describe las flechas: ¬øQu√© conecta con qu√©?\n3. Transcribe TODO el texto legible\n4. Para texto ilegible, pon [?] y describe el contexto\n5. Especifica colores de marcador{/m} {l}- NO interpretes el diagrama\n- NO inventes texto\n- Mant√©n ubicaci√≥n espacial{/l} {f}FORMATO:\n\n**BLOQUES/CAJAS:**\n1. [Ubicaci√≥n]: [Texto] - Color: [X]\n\n**CONEXIONES:**\n- [A] ‚Üí [B]: [texto sobre flecha]\n\n**TEXTO ILEGIBLE:**\n- [Ubicaci√≥n]: [?] [contexto]{/f} {v}‚úì Debe listar TODAS las cajas\n‚úì Todas las flechas documentadas\n‚úì Comparar con foto: ¬øFalta algo?{/v}', 
                '<p class="text-xs font-bold mb-2">üì∏ PRO-TIP:</p><p class="text-xs">Si la foto es borrosa, pide: "Bas√°ndome en el contexto, ¬øqu√© PODR√çA decir esa palabra? Dame 3 opciones probables."</p>', 
                'gemini', false, ["No usa Contexto", "Inventa Texto"], false, 'intermediate'),

            createCase(807, 'advanced', 'Gesti√≥n de Contexto Largo', 'article', 'Qu√© hacer cuando la IA "olvida"', 
                '[Mensaje #20] "Como te dije al principio..." ‚Üí IA: "Disculpa, ¬øqu√© dijiste?"',
                'Perdona, no recuerdo ese detalle. ¬øPodr√≠as repetir?', 
                '{r}Act√∫a como Project Manager.{/r} {c}Estamos en mensaje #18 sobre dise√±o de app de delivery.\n\nCONTEXTO INICIAL (Resumen de primeros 5 mensajes):\n- App: Delivery comida saludable\n- Target: Madres 30-45 a√±os\n- Presupuesto: $5M CLP\n- Features: Filtros por al√©rgenos, tracking tiempo real\n- Stack: React Native + Firebase{/c} {m}Usa este RESUMEN como referencia.\n\nPregunta actual: "¬øQu√© pasarela de pago recomiendas?"\n\nAl responder, VALIDA coherencia con:\n- El presupuesto\n- El p√∫blico objetivo\n- El stack{/m} {l}- No repitas preguntas ya respondidas\n- Si necesitas un dato que NO est√° en el resumen, pregunta{/l} {f}**Pasarela recomendada:** [Nombre]\n\n**Justificaci√≥n alineada a:**\n- Presupuesto: [impacto]\n- Target: [por qu√© funciona]\n- Stack: [facilidad integraci√≥n]\n\n**Costo estimado:** [cifra]{/f} {v}‚úì Debe mencionar presupuesto en justificaci√≥n\n‚úì No sugerir incompatible con Firebase\n‚úì Si excede budget, avisar{/v}', 
                '<p class="text-xs font-bold mb-2">üß† ESTRATEGIAS:</p><ol class="list-decimal ml-4 text-xs space-y-1"><li>Cada 10 mensajes, resume</li><li>Usa "anclas": "Recordando que..."</li><li>Crea un "Doc de referencia"</li><li>Numera decisiones</li><li>Si es muy largo, abre nuevo chat con resumen</li></ol>', 
                'claude', false, ["Sin Resumen", "Olvida Todo"], false, 'advanced'),

            createCase(808, 'advanced', 'Debugging de Prompts', 'bug_report', 'Identificar por qu√© un prompt falla', 
                'No me funciona. Genera cualquier cosa menos lo que pido.',
                'Intenta ser m√°s espec√≠fico en tu pregunta.', 
                '{r}Act√∫a como Ingeniero de Prompts que hace troubleshooting.{/r} {c}Este es el prompt que NO me funciona:\n\n"Crea un plan de marketing para mi negocio."\n\nProblema: La IA da un plan gen√©rico de 10 p√°ginas. Necesito algo ACCIONABLE para ESTA semana.{/c} {m}Analiza el prompt fallido usando esta checklist:\n\n1. ¬øTiene ROL claro?\n2. ¬øTiene CONTEXTO suficiente?\n3. ¬øTiene EJEMPLOS?\n4. ¬øLa META es espec√≠fica?\n5. ¬øTiene L√çMITES?\n6. ¬øEl FORMATO est√° definido?\n7. ¬øHay criterios de VALIDACI√ìN?{/m} {e}DIAGN√ìSTICO EJEMPLO:\n\n‚ùå "Escribe un art√≠culo sobre perros"\n\n**An√°lisis:**\n- [ ] Rol: ‚úó\n- [ ] Contexto: ‚úó\n- [ ] Ejemplos: ‚úó\n- [X] Formato: ‚úì\n- [ ] Validaci√≥n: ‚úó\n\n**Score: 1/7 - Prompt fallido**{/e} {l}Si tiene 0-2 checks, es MALO. Si tiene 5-7, deber√≠a funcionar.{/l} {f}**DIAGN√ìSTICO:**\n[Checklist con ‚úì o ‚úó]\n\n**SCORE:** X/7\n\n**PROBLEMA PRINCIPAL:** [fallo m√°s grave]\n\n**PROMPT MEJORADO:**\n[Versi√≥n corregida AGIA 2.0]{/f} {v}‚úì Prompt mejorado debe tener m√≠nimo 5/7 checks\n‚úì Debe ser copy-pasteable{/v}', 
                '<p class="text-xs font-bold mb-2">üìã RESULTADO:</p><p class="text-xs">Score: 0/7 - CR√çTICO</p><p class="text-xs mt-2"><strong>Problema:</strong> No especifica industria, tama√±o, situaci√≥n actual, ni horizonte temporal</p>', 
                'chatgpt', false, ["No Diagnostica", "Consejo Gen√©rico"], false, 'advanced'),

            createCase(809, 'advanced', 'Prompts para C√≥digo', 'code_blocks', 'Generar c√≥digo funcional, no ejemplos', 
                'Hazme un script de Python para leer un CSV.',
                'import csv\nwith open("archivo.csv") as f:\n    reader = csv.reader(f)\n    for row in reader:\n        print(row)', 
                '{r}Act√∫a como Senior Python Developer con 10 a√±os en data engineering.{/r} {c}Tengo un CSV con:\n- 50.000 filas de transacciones bancarias\n- Columnas: fecha,monto,categoria,descripcion\n- Problema: Algunos campos tienen comas dentro\n- Encoding: UTF-8 con tildes{/c} {e}EJEMPLO DE FILA PROBLEM√ÅTICA:\n2024-01-15,1500,"Restaurante, Plaza","Almuerzo ejecutivo"\n\n(La coma despu√©s de "Restaurante" rompe parsers simples){/e} {m}Genera script Python que:\n1. Lea el CSV manejando comas internas\n2. Convierta columna fecha a datetime\n3. Filtre solo "Alimentaci√≥n"\n4. Calcule gasto total\n5. Exporte a resultado.csv\n6. Maneje errores{/m} {l}REQUISITOS:\n- Python 3.8+\n- Usar pandas\n- Incluir logging\n- Docstrings\n- Type hints{/l} {f}```python\n# C√ìDIGO EJECUTABLE\n```\n\n**INSTRUCCIONES:**\n1. C√≥mo ejecutar\n2. Dependencias: pip install X{/f} {v}‚úì Ejecutar con python script.py debe funcionar\n‚úì No crashear si falta columna{/v}', 
                '<pre class="text-xs bg-slate-800 text-green-400 p-3 rounded">import pandas as pd\nimport logging\n\ndef procesar_transacciones(archivo):\n    df = pd.read_csv(archivo, quotechar=\'"\', escapechar=\'\\\\\')\n    # ...\n    return total</pre><p class="text-xs mt-2"><strong>pip install pandas</strong></p>', 
                'claude', false, ["Ejemplo Juguete", "Sin Error Handling"], false, 'intermediate'),

            createCase(810, 'advanced', 'Generaci√≥n Batch (Lotes)', 'inventory', 'Crear 50 variaciones de una vez', 
                'Hazme 10 t√≠tulos para posts de Instagram sobre yoga.',
                '1. Yoga para principiantes\n2. Beneficios del yoga\n3. Posturas de yoga...\n(T√≠tulos muy similares)', 
                '{r}Act√∫a como Copywriter especializado en wellness brands.{/r} {c}Contenido para cuenta de yoga dirigida a mujeres 25-40 que trabajan en oficina (sedentarias, estresadas).{/c} {e}EJEMPLOS DE BUENOS T√çTULOS:\n‚úì "3 estiramientos de escritorio que tu espalda te agradecer√°"\n‚úì "Por qu√© tu dolor de cuello no es normal (y c√≥mo el yoga ayuda)"\n‚úó "Yoga para todos" (muy gen√©rico)\n‚úó "Namaste üßò" (clich√©){/e} {m}Genera 20 t√≠tulos siguiendo esta matriz:\n\n- 5 EDUCATIVOS (ense√±an algo concreto)\n- 5 INSPIRACIONALES (motivaci√≥n)\n- 5 CONTROVERSIALES (rompen mitos)\n- 5 STORYTELLING (an√©cdotas){/m} {l}RESTRICCIONES:\n- M√°ximo 12 palabras por t√≠tulo\n- Sin emojis\n- No usar "zen", "namaste", "balance"\n- Incluir n√∫meros\n- 30% deben hacer pregunta directa{/l} {f}**EDUCATIVOS:**\n1. [T√≠tulo]\n2. [T√≠tulo]\n...\n\n**INSPIRACIONALES:**\n...\n\n(Repetir 4 categor√≠as){/f} {v}‚úì Exactamente 20 t√≠tulos\n‚úì Ninguno repite estructura\n‚úì Al menos 6 empiezan con pregunta{/v}', 
                '<p class="text-xs font-bold mb-2">üìù EJEMPLOS:</p><p class="text-xs"><strong>Educativos:</strong></p><ol class="list-decimal ml-4 text-xs"><li>"La postura que deshace 8 horas de silla"</li><li>"Respira as√≠ para calmar ansiedad en 2 minutos"</li></ol><p class="text-xs mt-2"><strong>Controversiales:</strong></p><ol class="list-decimal ml-4 text-xs"><li>"No necesitas ser flexible para hacer yoga"</li><li>"El dolor muscular NO significa que funciona"</li></ol>', 
                'chatgpt', false, ["Todos Iguales", "Sin Variedad"], false, 'intermediate'),

            // --- OFICINA & EXCEL (Solo muestro el caso mejorado) ---
            createCase(22, 'office', 'El Limpiador de Data', 'cleaning_services', 'Base de datos sucia (Nombres, May√∫sculas).', 
                'Limpia estos nombres de la columna A y d√©jalos en formato t√≠tulo.',
                'Puedes usar =NOMPROPIO(A1) para convertir a formato t√≠tulo. O limpia los espacios con ESPACIOS.', 
                '{r}Act√∫a como Ingeniero de Datos especializado en limpieza con Excel.{/r} {c}Tengo una columna A con 500 nombres extra√≠dos de una web:\n- Algunos est√°n en MAY√öSCULAS: "JUAN P√âREZ"\n- Otros mezclados: "maR√≠a GonZ√°lez"\n- Muchos tienen espacios extra: "  Pedro   L√≥pez  "{/c} {e}EJEMPLO DE ENTRADA:\nA1: "  MAR√çA    GONZ√ÅLEZ  "\nA2: "juAN  p√ârez"\n\nEJEMPLO DE SALIDA ESPERADA:\nB1: "Mar√≠a Gonz√°lez"\nB2: "Juan P√©rez"{/e} {m}Genera UNA SOLA f√≥rmula de Excel que:\n1. Elimine espacios extras (inicio, fin, y m√∫ltiples entre palabras)\n2. Convierta a formato Nombre Propio (Primera letra may√∫scula)\n3. Sea copiable a toda la columna{/m} {l}- Solo f√≥rmulas nativas de Excel (no VBA ni Power Query)\n- Debe funcionar en Excel 2016 o superior\n- Una sola celda de f√≥rmula{/l} {f}FORMATO DE RESPUESTA:\n```\n=F√ìRMULA_AQU√ç\n```\n\n**Explicaci√≥n en 2 l√≠neas:**\n- [Qu√© hace cada funci√≥n]\n- [Por qu√© funciona]{/f} {v}CRITERIO DE √âXITO:\nLa f√≥rmula debe transformar "  MAR√çA    GONZ√ÅLEZ  " en "Mar√≠a Gonz√°lez" sin errores.{/v}', 
                '<div class="font-mono text-xs bg-slate-800 text-green-400 p-3 rounded mb-2">=NOMPROPIO(ESPACIOS(A1))</div><p class="text-xs text-slate-600"><strong>Explicaci√≥n:</strong></p><ul class="list-disc ml-4 text-xs text-slate-600"><li>ESPACIOS() elimina espacios al inicio, final y m√∫ltiples entre palabras</li><li>NOMPROPIO() convierte la primera letra de cada palabra a may√∫scula</li></ul><p class="text-xs text-slate-600 mt-2"><strong>‚úì Validaci√≥n:</strong> "  MAR√çA    GONZ√ÅLEZ  " ‚Üí "Mar√≠a Gonz√°lez"</p>', 
                'gemini', false, ["Sin Contexto Espec√≠fico", "Sin Ejemplos", "Vago"], false, 'beginner'),

            // --- HERRAMIENTAS (Fichas T√©cnicas) ---
            createCase(901, 'tools', 'Gu√≠a: ChatGPT', 'bolt', '¬øCu√°ndo usar ChatGPT?', 'Ideal para texto e ideas.', 
                '', '{r}Tool{/r}', 
                '<strong>Fortalezas:</strong><ul class="list-disc ml-4"><li>El mejor redactando textos creativos y correos.</li><li>Entiende muy bien el tono y contexto.</li><li>Excelente para lluvia de ideas y estrategias.</li></ul><br><strong>Versi√≥n Gratis:</strong><ul class="list-disc ml-4"><li>Acceso al modelo inteligente (limitado) y al modelo r√°pido (ilimitado).</li><li>Genera pocas im√°genes al d√≠a.</li></ul>', 
                '...', 'chatgpt', false, [], true, 'beginner'), 
            
            createCase(902, 'tools', 'Gu√≠a: Gemini', 'psychology', '¬øCu√°ndo usar Gemini?', 'Ideal para documentos e im√°genes.', 
                '', '{r}Tool{/r}',
                '<strong>Fortalezas:</strong><ul class="list-disc ml-4"><li>Tiene una memoria gigante (puedes subir PDFs de 100 p√°ginas).</li><li>Conectado a Google (busca informaci√≥n actual).</li><li>Genera im√°genes realistas de alta calidad gratis.</li></ul><br><strong>Versi√≥n Gratis:</strong><ul class="list-disc ml-4"><li>Modelo muy r√°pido y capaz.</li><li>Ideal para resumir y analizar archivos.</li></ul>', 
                '...', 'gemini', false, [], true, 'beginner'),
            
            createCase(903, 'tools', 'Gu√≠a: Claude', 'auto_awesome', '¬øCu√°ndo usar Claude?', 'Ideal para c√≥digo y escritura humana.', 
                '', '{r}Tool{/r}',
                '<strong>Fortalezas:</strong><ul class="list-disc ml-4"><li>Escribe de forma muy natural y "humana".</li><li>Muy preciso siguiendo instrucciones complejas.</li><li>Excelente para programar y f√≥rmulas de Excel.</li></ul><br><strong>Versi√≥n Gratis:</strong><ul class="list-disc ml-4"><li>Acceso al modelo m√°s inteligente.</li><li>L√≠mite de mensajes diario muy estricto (se acaba r√°pido).</li></ul>', 
                '...', 'claude', false, [], true, 'beginner'),
            
            createCase(904, 'tools', 'Gu√≠a: Midjourney', 'palette', '¬øCu√°ndo usar Midjourney?', 'Ideal para arte profesional.', 
                '', '{r}Tool{/r}',
                '<strong>Fortalezas:</strong><ul class="list-disc ml-4"><li>Calidad art√≠stica insuperable (fotograf√≠a, ilustraci√≥n, 3D).</li><li>Estilos visuales muy creativos.</li></ul><br><strong>Versi√≥n Gratis:</strong><ul class="list-disc ml-4"><li><strong>NO TIENE.</strong> Es una herramienta de pago.</li><li>Recomendada solo si trabajas en dise√±o o arte.</li></ul>', 
                '...', 'midjourney', false, [], true, 'beginner')
        ];

        // --- L√ìGICA UI ---
        let currentCategory = 'advanced'; 
        let searchQuery = '';

        function init() {
            renderCategories();
            renderCaseList();
            selectCase(801);
            
            // Show welcome modal on first visit
            const hasSeenWelcome = localStorage.getItem('agia_v2_welcome_seen');
            if (!hasSeenWelcome) {
                setTimeout(() => {
                    document.getElementById('welcome-modal').classList.remove('hidden');
                }, 500);
            }
        }

        function closeWelcome() {
            document.getElementById('welcome-modal').classList.add('hidden');
            localStorage.setItem('agia_v2_welcome_seen', 'true');
        }

        function renderCategories() {
            const nav = document.getElementById('category-nav');
            if(!nav) return;
            nav.innerHTML = Object.keys(categoryConfig).map(key => {
                const conf = categoryConfig[key];
                const isActive = currentCategory === key;
                
                const activeClass = isActive 
                    ? `bg-white text-indigo-700 shadow-md font-bold` 
                    : `bg-white/10 text-white hover:bg-white/20`;
                
                return `<button onclick="setCategory('${key}')" class="flex items-center gap-2 px-4 py-2 rounded-full text-xs transition-all whitespace-nowrap backdrop-blur-sm ${activeClass} border border-white/10">
                    <span class="material-symbols-outlined text-lg">${conf.icon}</span>
                    ${conf.label}
                </button>`;
            }).join('');
        }

        function renderCaseList() {
            const listEl = document.getElementById('case-list');
            if(!listEl) return;
            
            const filtered = allCases.filter(c => (c.category === currentCategory || searchQuery !== '') && (c.title.toLowerCase().includes(searchQuery.toLowerCase()) || c.problem.toLowerCase().includes(searchQuery.toLowerCase())));
            
            const countDisplay = document.getElementById('count-display');
            if(countDisplay) countDisplay.innerText = allCases.length; 
            
            if (filtered.length === 0) {
                listEl.innerHTML = `<div class="p-8 text-center text-slate-400 text-xs">No hay resultados</div>`;
                return;
            }

            listEl.innerHTML = filtered.map(c => {
                const config = categoryConfig[c.category];
                
                let iconDisplay = c.locked ? 'lock' : c.icon;
                let iconColorClass = '';
                
                if (c.category === 'tools') {
                    iconColorClass = c.locked ? 'text-slate-300 bg-slate-50' : `text-slate-600 bg-slate-100`;
                } else {
                    iconColorClass = c.locked ? 'text-slate-300 bg-slate-50' : `text-${config.color}-600 bg-${config.color}-50`;
                }

                const lockOpacity = c.locked ? 'opacity-70 grayscale' : '';
                
                // Difficulty badge
                const difficultyConfig = {
                    beginner: { label: 'B√ÅSICO', color: 'bg-green-100 text-green-700 border-green-200' },
                    intermediate: { label: 'INTERMEDIO', color: 'bg-blue-100 text-blue-700 border-blue-200' },
                    advanced: { label: 'AVANZADO', color: 'bg-purple-100 text-purple-700 border-purple-200' }
                };
                
                const diff = difficultyConfig[c.difficulty] || difficultyConfig['beginner'];
                const diffBadge = c.category === 'advanced' ? `<span class="text-[8px] ${diff.color} px-1.5 py-0.5 rounded-full border tracking-wide font-bold">${diff.label}</span>` : '';
                
                return `<button onclick="selectCase(${c.id}); if(window.innerWidth < 768) toggleSidebar();" class="w-full text-left p-3 rounded-xl group transition-all hover:bg-slate-50 border border-transparent hover:border-slate-200 relative overflow-hidden ${lockOpacity}">
                    <div class="flex items-center gap-3 pl-1">
                        <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-none shadow-sm ${iconColorClass}">
                            <span class="material-symbols-outlined text-xl">${iconDisplay}</span>
                        </div>
                        <div class="overflow-hidden flex-1">
                            <h4 class="text-sm font-bold text-slate-700 truncate group-hover:text-indigo-700 transition-colors flex items-center gap-2">
                                ${c.title} 
                                ${!c.locked && !c.isTool ? '<span class="text-[9px] bg-green-100 text-green-700 px-1.5 rounded-full border border-green-200 tracking-wide">GRATIS</span>' : ''}
                                ${diffBadge}
                            </h4>
                            <p class="text-[11px] text-slate-400 truncate leading-tight mt-0.5">${c.locked ? 'Solo miembros Premium' : c.problem}</p>
                        </div>
                    </div>
                </button>`;
            }).join('');
        }

        function selectCase(id) {
            const c = allCases.find(x => x.id === id);
            if(!c) return;

            if (c.locked) {
                openPaywall();
                return;
            }

            const conf = categoryConfig[c.category];
            const ai = aiConfig[c.suggestedAI] || aiConfig['chatgpt']; 

            const isTool = c.category === 'tools';

            const setInnerText = (id, text) => {
                const el = document.getElementById(id);
                if(el) el.innerText = text;
            };
            
            setInnerText('detail-title', c.title);
            setInnerText('detail-icon', c.icon);
            setInnerText('detail-problem', c.problem);
            
            const iconBg = document.getElementById('detail-icon-bg');
            if(iconBg) {
                const iconBgClass = isTool 
                    ? `bg-slate-100 text-slate-600 border-slate-200` 
                    : `bg-${conf.color}-50 text-${conf.color}-600 border-white shadow-sm`;
                iconBg.className = `w-12 h-12 md:w-16 md:h-16 rounded-2xl flex items-center justify-center border-2 ${iconBgClass}`;
            }
            
            const badge = document.getElementById('detail-category-badge');
            if(badge) {
                badge.innerText = conf.label;
                const badgeColorClass = isTool
                    ? `bg-slate-100 text-slate-600 border-slate-200`
                    : `bg-${conf.color}-100 text-${conf.color}-800 border-${conf.color}-200`;
                badge.className = `text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-full border ${badgeColorClass}`;
            }
            
            // Badge Tooltip
            const badgeHTML = `
                <div class="tooltip-trigger relative group">
                    <div class="${ai.bg} text-white px-3 py-1 rounded-full flex items-center gap-2 shadow-lg ring-1 ring-white/20 cursor-help transition-transform hover:scale-105">
                        <span class="material-symbols-outlined text-sm">${ai.icon}</span>
                        <span class="text-[10px] font-bold tracking-wide uppercase">${isTool ? 'Plataforma' : 'Sugerida: ' + ai.name}</span>
                    </div>
                    <div class="tooltip-content hidden absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-48 bg-slate-800 text-white text-[10px] p-2 rounded shadow-xl text-center border border-slate-600 z-50">
                        ${isTool ? 'Informaci√≥n de la herramienta.' : 'Es solo una sugerencia, no un requisito. Puedes usar la IA que prefieras.'}
                        <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-slate-800"></div>
                    </div>
                </div>
            `;
            
            const aiContainer = document.getElementById('ai-badge-container');
            if(aiContainer) aiContainer.innerHTML = badgeHTML;
            const aiMobile = document.getElementById('ai-badge-mobile');
            if(aiMobile) aiMobile.innerHTML = badgeHTML;

            const mainBox = document.getElementById('main-box');
            const boxHeader = document.getElementById('box-header');
            const boxHeaderIcon = document.getElementById('box-header-icon');
            const boxHeaderText = document.getElementById('box-header-text');
            const boxActions = document.getElementById('box-actions');
            const promptContent = document.getElementById('detail-prompt-rendered');
            const agiaLegend = document.getElementById('agia-legend');
            const compContainer = document.getElementById('comparison-container');
            const verifiedBadge = document.getElementById('detail-verified-badge');

            if (isTool) {
                if(compContainer) compContainer.classList.add('hidden');
                if(mainBox) mainBox.className = "bg-white rounded-2xl shadow-md mb-8 border border-slate-200 relative transition-all duration-300";
                if(boxHeader) boxHeader.className = "bg-slate-50 px-6 py-4 flex justify-between items-center border-b border-slate-100 rounded-t-2xl";
                
                if(boxHeaderIcon) boxHeaderIcon.classList.add('hidden');
                if(boxHeaderText) boxHeaderText.classList.add('hidden');
                if(boxActions) boxActions.classList.add('hidden'); 
                if(agiaLegend) agiaLegend.classList.add('hidden');
                if(verifiedBadge) verifiedBadge.classList.add('hidden');

                if(promptContent) {
                    promptContent.innerHTML = c.agiaPromptTagged;
                    promptContent.className = "text-slate-700 prose-sm leading-relaxed";
                }

            } else {
                if(compContainer) compContainer.classList.remove('hidden');
                
                if(mainBox) mainBox.className = "bg-slate-900 rounded-2xl shadow-xl mb-8 border border-slate-700 relative transition-all duration-300 group";
                if(boxHeader) boxHeader.className = "bg-slate-800/50 px-6 py-4 flex justify-between items-center border-b border-slate-700/50 rounded-t-2xl";

                if(boxHeaderIcon) boxHeaderIcon.classList.remove('hidden');
                if(boxHeaderText) boxHeaderText.classList.remove('hidden');
                if(boxActions) boxActions.classList.remove('hidden');
                if(agiaLegend) agiaLegend.classList.remove('hidden');
                if(verifiedBadge) verifiedBadge.classList.remove('hidden');

                setInnerText('detail-bad-prompt', `"${c.badPrompt}"`);
                setInnerText('detail-bad-result', c.badResponsePreview);
                
                const badgesContainer = document.getElementById('deficiency-badges');
                if(badgesContainer) {
                    badgesContainer.innerHTML = c.deficiencies.map(d => 
                        `<span class="px-2 py-1 bg-red-50 text-red-600 text-[10px] font-bold rounded-md border border-red-100 flex items-center gap-1"><span class="material-symbols-outlined text-[10px]">warning</span>${d}</span>`
                    ).join('');
                }

                if(promptContent) {
                    promptContent.innerHTML = renderAGIA(c.agiaPromptTagged);
                    promptContent.className = "font-mono text-sm md:text-base leading-loose text-slate-300 select-all whitespace-pre-wrap";
                }
                
                const previewRes = document.getElementById('preview-response');
                if(previewRes) previewRes.innerHTML = c.previewResponse;
            }

            if(window.innerWidth < 768) toggleSidebar();
        }

        function setCategory(cat) {
            currentCategory = cat;
            searchQuery = '';
            const searchInput = document.getElementById('searchInput');
            if(searchInput) searchInput.value = '';
            renderCategories();
            renderCaseList();
        }

        function filterCases() {
            const searchInput = document.getElementById('searchInput');
            if(searchInput) {
                searchQuery = searchInput.value;
                renderCaseList();
            }
        }

        function copyPrompt() {
            const titleEl = document.getElementById('detail-title');
            if(!titleEl) return;
            
            const title = titleEl.innerText;
            const c = allCases.find(x => x.title === title);
            if(!c) return;

            const rawText = c.category === 'tools' 
                ? document.getElementById('detail-prompt-rendered').innerText 
                : cleanAGIA(c.agiaPromptTagged);
                
            navigator.clipboard.writeText(rawText);
            
            // Analytics: Guardar estad√≠stica
            try {
                const storageKey = `case_${c.id}_copied`;
                const currentCount = parseInt(localStorage.getItem(storageKey) || '0');
                localStorage.setItem(storageKey, (currentCount + 1).toString());
                localStorage.setItem(`case_${c.id}_last_copy`, new Date().toISOString());
            } catch(e) {
                console.log('Analytics storage failed:', e);
            }
            
            const btn = document.querySelector('#box-actions'); 
            if(!btn) return;
            
            const originalHTML = btn.innerHTML;
            
            btn.innerHTML = `<span class="material-symbols-outlined text-sm">check_circle</span> <span>¬°COPIADO!</span>`;
            btn.classList.remove('bg-slate-700', 'text-white');
            btn.classList.add('bg-green-500', 'text-white', 'border-green-400');
            
            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.classList.remove('bg-green-500', 'text-white', 'border-green-400');
                btn.classList.add('bg-slate-700', 'text-white');
            }, 2000);
        }

        function openPaywall() {
            document.getElementById('paywall-modal').classList.remove('hidden');
        }
        
        function closePaywall() {
            document.getElementById('paywall-modal').classList.add('hidden');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
        }

        init();
    </script>
</body>
</html>
