<!DOCTYPE html>
<html lang="es-CL">

<head>
    <!-- Meta Pixel Code -->
    <script>
        !function (f, b, e, v, n, t, s) {
            if (f.fbq) return; n = f.fbq = function () {
                n.callMethod ?
                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
            n.queue = []; t = b.createElement(e); t.async = !0;
            t.src = v; s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, 'script',
            'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1356922049450142');
        fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
            src="https://www.facebook.com/tr?id=1356922049450142&ev=PageView&noscript=1" /></noscript>
    <!-- End Meta Pixel Code -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Accede o Crea tu Cuenta - Aula GenIA</title>
    <meta name="description"
        content="Inicia sesión o regístrate para acceder a los cursos de Inteligencia Artificial de Aula GenIA. Comienza tu viaje de aprendizaje hoy.">
    <meta name="keywords" content="iniciar sesión, crear cuenta, registro, acceso alumnos, Aula GenIA, login">
    <link rel="canonical" href="https://aulagenia.cl/acceso.html">
    <link rel="icon" href="favicon.ico?v=2" type="image/x-icon">
    <link rel="apple-touch-icon" href="https://aulagenia.cl/Logo_AGIA.png">
    <meta property="og:title" content="Accede o Crea tu Cuenta - Aula GenIA">
    <meta property="og:description"
        content="Inicia sesión o regístrate para acceder a los cursos de Inteligencia Artificial de Aula GenIA.">
    <meta property="og:image" content="https://aulagenia.cl/og-image.jpg">
    <meta property="og:url" content="https://aulagenia.cl/acceso.html">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="es_ES">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Accede o Crea tu Cuenta - Aula GenIA">
    <meta name="twitter:description"
        content="Inicia sesión o regístrate para acceder a los cursos de Inteligencia Artificial de Aula GenIA.">
    <meta name="twitter:image" content="https://aulagenia.cl/og-image.jpg">
    <script type="application/ld+json">{
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "Organization",
          "name": "Aula GenIA",
          "url": "https://aulagenia.cl/",
          "logo": "https://aulagenia.cl/Logo_AGIA.png"
        },
        {
          "@type": "WebSite",
          "name": "Aula GenIA",
          "url": "https://aulagenia.cl/",
          "potentialAction": {
            "@type": "SearchAction",
            "target": "https://aulagenia.cl/cursos.html?q={search_term_string}",
            "query-input": "required name=search_term_string"
          }
        }
      ]
    }</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css">
    <link href="css/styles.css" rel="stylesheet">
    <style>
        :root {
            --brand-teal: #14b8a6;
            --brand-blue: #3b82f6;
            --brand-yellow: #f59e0b
        }

        body {
            font-family: Poppins, sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh
        }

        main {
            flex-grow: 1
        }

        .logo-highlight {
            color: var(--brand-teal)
        }

        .gradient-button {
            background: linear-gradient(90deg, #2dd4bf, #fbbf24);
            transition: all .3s ease
        }

        .gradient-button:hover {
            background: linear-gradient(90deg, #0e9488, #d97706);
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(20, 184, 166, .3)
        }

        .auth-tab {
            width: 50%;
            padding: .75rem 1rem;
            font-weight: 600;
            color: #9ca3af;
            border-bottom: 2px solid transparent;
            transition: all .3s ease;
            cursor: pointer
        }

        .auth-tab:hover {
            color: #d1d5db
        }

        .auth-tab.active-tab {
            color: #fff;
            border-bottom-color: var(--brand-teal)
        }
    </style>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-black text-white">
    <header class="container mx-auto flex justify-center px-6 py-4"><a href="index.html" class="block"
            aria-label="Página de inicio de Aula GenIA"><img src="https://aulagenia.cl/logo_dark.png"
                alt="Logo de Aula GenIA" class="h-12 w-auto"
                onerror='this.onerror=null,this.src="https://placehold.co/200x48/000000/ffffff?text=AulaGenIA"'></a>
    </header>
    <main class="flex items-center justify-center px-6 py-12">
        <div class="w-full max-w-md rounded-2xl border border-gray-700 bg-gray-800 p-8 shadow-lg">
            <h1 id="auth-title" class="mb-6 text-center text-3xl font-bold">Crea tu cuenta para continuar al pago</h1>

            <!-- Banner informativo cuando viene desde Flow -->
            <div id="flow-success-banner"
                class="hidden mb-6 p-4 bg-gradient-to-r from-green-500/20 to-teal-500/20 border border-green-500/50 rounded-xl">
                <div class="flex items-start gap-3">
                    <svg class="w-6 h-6 text-green-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="flex-1">
                        <h3 class="font-bold text-green-400 mb-1">¡Pago confirmado!</h3>
                        <p class="text-sm text-gray-300 mb-2">Tu email: <span id="flow-email-display"
                                class="font-mono text-teal-400"></span></p>
                        <p class="text-xs text-gray-400">
                            <strong>Opción 1:</strong> Usa "Continuar con Google" (más rápido)<br>
                            <strong>Opción 2:</strong> Crea cuenta con el email mostrado arriba
                        </p>
                    </div>
                </div>
            </div>

            <!-- OPCIÓN PRINCIPAL: GOOGLE (Premium UX) -->
            <div class="relative mb-3">
                <!-- Badge animado -->
                <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 z-10">
                    <span
                        class="inline-flex items-center gap-1.5 bg-gradient-to-r from-teal-500 to-cyan-500 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg border-2 border-gray-800 animate-pulse">
                        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                            <path
                                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        RECOMENDADO
                    </span>
                </div>
                <!-- Contenedor con borde brillante -->
                <div
                    class="p-1 bg-gradient-to-r from-teal-400 via-cyan-400 to-teal-400 rounded-xl shadow-lg shadow-teal-500/30">
                    <button id="google-signin-btn"
                        class="flex w-full items-center justify-center rounded-lg bg-white py-4 px-4 font-bold text-gray-800 shadow-inner transition-all duration-300 ease-in-out hover:bg-gray-50 hover:scale-[1.02]">
                        <svg class="mr-3 h-6 w-6" viewBox="0 0 48 48" aria-hidden="true">
                            <path fill="#FFC107"
                                d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z">
                            </path>
                            <path fill="#FF3D00"
                                d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z">
                            </path>
                            <path fill="#4CAF50"
                                d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z">
                            </path>
                            <path fill="#1976D2"
                                d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C42.022,35.244,44,30.036,44,24C44,22.659,43.862,21.35,43.611,20.083z">
                            </path>
                        </svg>
                        Continuar con Google
                    </button>
                </div>
                <!-- Micro-copy de beneficio -->
                <p class="text-center text-xs text-gray-400 mt-2 flex items-center justify-center gap-1">
                    <svg class="w-3.5 h-3.5 text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    Más rápido · Solo 1 clic
                </p>
            </div>

            <!-- Divisor sutil -->
            <div class="flex items-center gap-3 my-4">
                <div class="flex-grow border-t border-gray-700"></div>
                <span class="text-xs text-gray-500 uppercase tracking-wider">o usa otra opción</span>
                <div class="flex-grow border-t border-gray-700"></div>
            </div>

            <!-- OPCIÓN SECUNDARIA: FACEBOOK (De-enfatizado) -->
            <button id="facebook-signin-btn"
                class="flex w-full items-center justify-center rounded-lg bg-gray-700 py-3 px-4 font-medium text-gray-300 border border-gray-600 transition-all duration-300 ease-in-out hover:bg-gray-600 hover:text-white">
                <svg class="mr-3 h-5 w-5 opacity-70" viewBox="0 0 24 24" aria-hidden="true" fill="currentColor">
                    <path
                        d="M22.675 0h-21.35C.597 0 0 .597 0 1.326v21.348C0 23.403.597 24 1.326 24H12.82v-9.294H9.692v-3.622h3.128V8.413c0-3.1 1.893-4.785 4.659-4.785 1.325 0 2.464.099 2.796.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116C23.403 24 24 23.403 24 22.674V1.326C24 .597 23.403 0 22.675 0z" />
                </svg>
                Continuar con Facebook
            </button>
            <div class="my-6 flex items-center">
                <div class="flex-grow border-t border-gray-600"></div><span
                    class="mx-4 flex-shrink text-gray-400">O</span>
                <div class="flex-grow border-t border-gray-600"></div>
            </div>
            <div class="mb-8 flex border-b border-gray-700"><button id="login-tab" class="auth-tab" role="tab"
                    aria-selected="false" aria-controls="login-form-container">Iniciar Sesión</button> <button
                    id="register-tab" class="auth-tab active-tab" role="tab" aria-selected="true"
                    aria-controls="register-form-container">Crear
                    Cuenta</button></div>
            <div id="login-form-container" class="hidden" role="tabpanel" aria-labelledby="login-tab">
                <form id="login-form" novalidate>
                    <div class="space-y-6">
                        <div><label for="login-email" class="mb-2 block text-sm font-medium text-gray-300">Correo
                                Electrónico</label>
                            <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3"
                                    aria-hidden="true"><i data-lucide="mail" class="h-5 w-5 text-gray-400"></i></span>
                                <input type="email" id="login-email" placeholder="tu@email.com" required
                                    aria-required="true" autocomplete="email"
                                    class="w-full rounded-lg border-gray-600 bg-gray-700 p-3 pl-10 focus:border-teal-400 focus:ring-teal-400">
                            </div>
                        </div>
                        <div><label for="login-password"
                                class="mb-2 block text-sm font-medium text-gray-300">Contraseña</label>
                            <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3"
                                    aria-hidden="true"><i data-lucide="lock" class="h-5 w-5 text-gray-400"></i></span>
                                <input type="password" id="login-password" placeholder="••••••••" required
                                    aria-required="true" autocomplete="current-password"
                                    class="w-full rounded-lg border-gray-600 bg-gray-700 p-3 pl-10 focus:border-teal-400 focus:ring-teal-400">
                            </div><a href="#" id="forgot-password-link"
                                class="float-right mt-2 text-sm text-teal-400 hover:text-teal-300">¿Olvidaste tu
                                contraseña?</a>
                        </div>
                    </div><button type="submit"
                        class="gradient-button mt-10 w-full rounded-lg py-3 text-lg font-bold">Iniciar
                        Sesión</button>
                </form>
            </div>
            <div id="register-form-container" role="tabpanel" aria-labelledby="register-tab">
                <form id="register-form" novalidate>
                    <div class="space-y-6">
                        <div><label for="register-name" class="mb-2 block text-sm font-medium text-gray-300">Nombre
                                Completo</label>
                            <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3"
                                    aria-hidden="true"><i data-lucide="user" class="h-5 w-5 text-gray-400"></i></span>
                                <input type="text" id="register-name" placeholder="Tu Nombre" required
                                    aria-required="true" autocomplete="name"
                                    class="w-full rounded-lg border-gray-600 bg-gray-700 p-3 pl-10 focus:border-teal-400 focus:ring-teal-400">
                            </div>
                        </div>
                        <div><label for="register-email" class="mb-2 block text-sm font-medium text-gray-300">Correo
                                Electrónico</label>
                            <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3"
                                    aria-hidden="true"><i data-lucide="mail" class="h-5 w-5 text-gray-400"></i></span>
                                <input type="email" id="register-email" placeholder="tu@email.com" required
                                    aria-required="true" autocomplete="email"
                                    class="w-full rounded-lg border-gray-600 bg-gray-700 p-3 pl-10 focus:border-teal-400 focus:ring-teal-400">
                            </div>
                        </div>
                        <div><label for="register-password"
                                class="mb-2 block text-sm font-medium text-gray-300">Contraseña</label>
                            <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3"
                                    aria-hidden="true"><i data-lucide="lock" class="h-5 w-5 text-gray-400"></i></span>
                                <input type="password" id="register-password" placeholder="Crea una contraseña segura"
                                    required aria-required="true" autocomplete="new-password"
                                    class="w-full rounded-lg border-gray-600 bg-gray-700 p-3 pl-10 focus:border-teal-400 focus:ring-teal-400">
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 flex items-start">
                        <div class="flex h-5 items-center"><input id="marketing-opt-in" type="checkbox"
                                checked="checked"
                                class="h-4 w-4 cursor-pointer rounded border-gray-500 bg-gray-700 text-teal-500 focus:ring-teal-500">
                        </div>
                        <div class="ml-3 text-sm"><label for="marketing-opt-in"
                                class="cursor-pointer text-gray-300">Quiero
                                recibir correos con novedades y promociones.</label></div>
                    </div><button type="submit"
                        class="gradient-button mt-6 w-full rounded-lg py-3 text-lg font-bold">Crear mi
                        Cuenta</button>
                </form>
            </div>
        </div>
        <div id="userInfo" style="display:none" class="mt-6 text-center"><img id="userPhoto"
                class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-teal-500">
            <p id="userName" class="text-xl font-semibold mb-1"></p>
            <p id="userEmail" class="text-sm text-gray-400 mb-6"></p><button id="logoutBtn"
                class="gradient-button w-full py-3 px-4 rounded-lg text-white font-bold">Cerrar Sesión</button>
        </div>
        </div>
    </main>
    <footer class="container mx-auto text-center px-6 py-4">
        <p class="text-xs text-gray-500">Al crear una cuenta, aceptas nuestros <a href="terminoscondiciones.html"
                class="text-teal-400 hover:underline">Términos de Servicio</a> y <a href="politica-privacidad.html"
                class="text-teal-400 hover:underline">Política de Privacidad</a>.</p>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js"
        defer="defer"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js" defer="defer"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js" defer="defer"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics-compat.js" defer="defer"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-functions-compat.js" defer="defer"></script>
    <script defer="defer">document.addEventListener("DOMContentLoaded", () => {
            // --- ENHANCED SMART LOGIN START ---
            try {
                // Check for email in URL parameters (from Flow payment)
                const urlParams = new URLSearchParams(window.location.search);
                const emailFromUrl = urlParams.get('email');

                const savedMethod = localStorage.getItem('agia_login_method');
                const savedEmail = localStorage.getItem('agia_user_email');
                const emailToUse = emailFromUrl || savedEmail;

                if (emailToUse) {
                    setTimeout(() => {
                        const loginTab = document.getElementById("login-tab");
                        const registerTab = document.getElementById("register-tab");
                        const loginEmailInput = document.getElementById("login-email");
                        const registerEmailInput = document.getElementById("register-email");
                        const registerNameInput = document.getElementById("register-name");
                        const passInput = document.getElementById("login-password");
                        const authTitle = document.getElementById("auth-title");

                        // If email comes from URL (post-payment), show register tab
                        if (emailFromUrl) {
                            if (registerTab) registerTab.click();
                            if (registerEmailInput) registerEmailInput.value = emailFromUrl;
                            if (registerNameInput) registerNameInput.focus();
                            if (authTitle) authTitle.textContent = '¡Pago exitoso! Crea tu cuenta para acceder';

                            // Show success banner with email
                            const flowBanner = document.getElementById('flow-success-banner');
                            const flowEmailDisplay = document.getElementById('flow-email-display');
                            if (flowBanner) flowBanner.classList.remove('hidden');
                            if (flowEmailDisplay) flowEmailDisplay.textContent = emailFromUrl;

                            console.log('✅ Email pre-llenado desde Flow:', emailFromUrl);
                        }
                        // If saved method is password, show login tab
                        else if (savedMethod === 'password') {
                            if (loginTab) loginTab.click();
                            if (loginEmailInput) loginEmailInput.value = savedEmail;
                            if (passInput) passInput.focus();
                            console.log('Smart Login activado para:', savedEmail);
                        }
                    }, 50);
                }
            } catch (e) { console.log('Smart login error', e); }
            // --- ENHANCED SMART LOGIN END ---

            firebase.initializeApp({ apiKey: "AIzaSyC9sVJwEfFdIN4VmSMooAoQLXYl5Mcu1yM", authDomain: "aulagenia.firebaseapp.com", projectId: "aulagenia", storageBucket: "aulagenia.appspot.com", messagingSenderId: "173328075630", appId: "1:173328075630:web:825606db4271ea1e66cf7f", measurementId: "G-X500LE6Z8X" }); const e = firebase.auth(), o = firebase.analytics(); o.logEvent("view_item", { item_id: "login_page", item_name: "Login/Register Page", content_type: "page" }); const t = document.getElementById("login-tab"), n = document.getElementById("register-tab"), a = document.getElementById("login-form-container"), r = document.getElementById("register-form-container"), i = document.getElementById("login-form"), s = document.getElementById("register-form"), c = document.getElementById("google-signin-btn"), l = document.getElementById("facebook-signin-btn"), d = document.getElementById("forgot-password-link"); t.addEventListener("click", () => { t.classList.add("active-tab"), n.classList.remove("active-tab"), a.classList.remove("hidden"), r.classList.add("hidden") }), n.addEventListener("click", () => { n.classList.add("active-tab"), t.classList.remove("active-tab"), r.classList.remove("hidden"), a.classList.add("hidden") }); const u = { "google.com": { name: "Google", instance: () => new firebase.auth.GoogleAuthProvider }, "facebook.com": { name: "Facebook", instance: () => { const e = new firebase.auth.FacebookAuthProvider; return e.addScope("email"), e.setCustomParameters({ display: "popup" }), e } }, password: { name: "correo y contraseña", instance: () => null } }; async function m(t) { try { await e.signInWithPopup(t) } catch (t) { if ("auth/account-exists-with-different-credential" !== t.code) return console.error("Error de autenticación:", t), void alert(`Ocurrió un error: ${t.message}`); const n = t.credential, a = (t.email || t.customData && t.customData.email || "").toLowerCase().trim(); if (console.log("--- Account Collision Detected ---"), console.log("Error Code:", t.code), console.log("Extracted Email:", a), console.log("Full Error Object:", t), !a) return console.error("No se pudo obtener el email del proveedor tras el error de colisión.", t), void alert("No pudimos obtener tu correo del proveedor para vincular las cuentas. Intenta iniciar sesión con tu método original."); console.log(`[Colisión] Buscando métodos de inicio de sesión para: ${a}`); const r = await e.fetchSignInMethodsForEmail(a); if (console.log("[Colisión] Métodos encontrados:", r), !r || 0 === r.length) return console.error("Inconsistencia de Firebase: 'auth/account-exists-with-different-credential' fue lanzado, pero fetchSignInMethodsForEmail retornó un arreglo vacío.", { email: a }), void alert("Ya existe una cuenta con este correo, pero el método fue Google. Por favor, intenta iniciar sesión directamente con tu método original (Google) o con tu correo y contraseña."); const i = r[0], s = u[i] || { name: i, instance: () => null }; if ("password" === i) return void alert(`Ya tienes una cuenta con ${s.name}. Por favor, inicia sesión con tu correo y contraseña para continuar.`); const c = s.instance(); if (!c) return void alert(`No se pudo reconstruir el proveedor original (${i}). Por favor, inicia sesión manualmente.`); alert(`Ya tienes una cuenta con ${s.name}. Inicia sesión con ${s.name} para vincular tu nueva cuenta.`); try { const { user: t } = await e.signInWithPopup(c); await t.linkWithCredential(n), console.log("¡Cuentas vinculadas con éxito!"), o.logEvent("login", { method: s.name }); if (typeof fbq !== 'undefined') { fbq('track', 'Lead'); } } catch (e) { console.error("Error al vincular las cuentas:", e), alert(`No se pudieron vincular las cuentas: ${e.message}`) } } }
            c.addEventListener("click", () => {
                const provider = new firebase.auth.GoogleAuthProvider();

                // Intentar obtener email del pre-llenado (URL o stored)
                // Usamos la misma lógica que el banner de éxito
                const urlParams = new URLSearchParams(window.location.search);
                const emailParam = urlParams.get('email');
                const storedEmail = localStorage.getItem('agia_user_email');
                const emailToHint = emailParam || storedEmail;

                if (emailToHint) {
                    provider.setCustomParameters({ login_hint: emailToHint });
                    console.log('✅ Google Login Hint aplicado:', emailToHint);
                }

                m(provider);
            }), l.addEventListener("click", () => { m(u["facebook.com"].instance()) }), s.addEventListener("submit", t => { t.preventDefault(); const n = s.querySelector("#register-name").value, a = s.querySelector("#register-email").value, r = s.querySelector("#register-password").value; e.createUserWithEmailAndPassword(a, r).then(e => e.user.updateProfile({ displayName: n })).then(() => { console.log("Usuario registrado y perfil actualizado:", e.currentUser), o.logEvent("sign_up", { method: "password" }); if (typeof fbq !== 'undefined') { fbq('track', 'CompleteRegistration'); } }).catch(e => { console.error("Error en el registro:", e), "auth/email-already-in-use" === e.code ? alert("Ya existe una cuenta con este correo electrónico. Por favor, intenta iniciar sesión o utiliza otro correo.") : alert(`Error en el registro: ${e.message}`) }) }), i.addEventListener("submit", t => { t.preventDefault(); const n = i.querySelector("#login-email").value, a = i.querySelector("#login-password").value; e.signInWithEmailAndPassword(n, a).then(e => { console.log("Usuario ha iniciado sesión:", e.user), o.logEvent("login", { method: "password" }); if (typeof fbq !== 'undefined') { fbq('track', 'Lead'); } }).catch(e => { console.error("Error en inicio de sesión:", e), alert("Error: Credenciales incorrectas. Por favor, inténtalo de nuevo.") }) }), d.addEventListener("click", o => { o.preventDefault(); const t = document.getElementById("login-email"), n = t.value; if (!n) return alert("Por favor, ingresa tu correo electrónico en el campo correspondiente para restablecer tu contraseña."), void t.focus(); e.sendPasswordResetEmail(n).then(() => { alert("Se ha enviado un correo para restablecer tu contraseña. Revisa tu bandeja de entrada (y la carpeta de spam).") }).catch(e => { console.error("Error al enviar correo de restablecimiento:", e), "auth/user-not-found" === e.code ? alert("No se encontró ninguna cuenta con ese correo electrónico.") : alert(`Ocurrió un error: ${e.message}`) }) }), e.onAuthStateChanged(async e => {
                if (e) {
                    console.log("Usuario autenticado. Verificando estado...");
                    if (typeof fbq !== 'undefined') { fbq('track', 'Lead'); }

                    // Manejo de compra pendiente (flujo modal -> login -> pago)
                    const pendingPurchase = sessionStorage.getItem("pendingPurchase");
                    if (pendingPurchase) {
                        console.log("Procesando compra pendiente...");
                        // Mostrar overlay de carga
                        const overlay = document.createElement("div");
                        overlay.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;";
                        overlay.innerHTML = '<div style="border:4px solid #f3f3f3;border-top:4px solid #14b8a6;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;"></div><h2 style="margin-top:20px;font-family:sans-serif;color:#333;">Procesando tu inscripción...</h2><style>@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style>';
                        document.body.appendChild(overlay);

                        try {
                            const purchaseData = JSON.parse(pendingPurchase);
                            const createPreference = firebase.functions().httpsCallable("createMercadoPagoPreference");
                            const result = await createPreference(purchaseData);
                            if (result.data && result.data.init_point) {
                                sessionStorage.removeItem("pendingPurchase");
                                window.location.href = result.data.init_point;
                                return;
                            }
                        } catch (err) {
                            console.error("Error al procesar pago:", err);
                            alert("Error al iniciar el pago. Por favor intenta nuevamente.");
                            overlay.remove();
                        }
                    }

                    const r = new URLSearchParams(window.location.search).get("redirect") || "campus.html";
                    window.location.href = r
                } else document.getElementById("auth-container") ? document.getElementById("auth-container").style.display = "block" : null, document.getElementById("userInfo") ? document.getElementById("userInfo").style.display = "none" : null, document.getElementById("auth-title") ? document.getElementById("auth-title").textContent = "Crea tu cuenta para continuar al pago" : null
            }), lucide.createIcons(), window.addEventListener("load", () => { window.cookieconsent && window.cookieconsent.initialise({ palette: { popup: { background: "#1f2937" }, button: { background: "#14b8a6" } }, theme: "classic", position: "bottom", type: "opt-in", content: { message: "Usamos cookies para mejorar tu experiencia.", dismiss: "Aceptar", deny: "Rechazar", link: "Más info", href: "politica-cookies.html" } }) })
        })</script>
</body>

</html>