<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aula GenIA | Glosario Interactivo Aplicado</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        /* CONFIGURACIÓN BASE - LIGHT MODE (matches campus) */
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            display: flex;
            flex-direction: column;
        }

        /* EFECTO AURORA - Light version (subtle teal/cyan) */
        .aurora-blob {
            position: absolute;
            filter: blur(120px);
            z-index: 0;
            opacity: 0.15;
            animation: float 20s infinite ease-in-out alternate;
        }

        .blob-1 {
            top: -20%;
            left: -10%;
            width: 60vw;
            height: 60vw;
            background: #99f6e4;
            /* Teal 200 */
            animation-delay: 0s;
        }

        .blob-2 {
            bottom: -20%;
            right: -10%;
            width: 50vw;
            height: 50vw;
            background: #a5f3fc;
            /* Cyan 200 */
            animation-delay: 5s;
        }

        .blob-3 {
            top: 30%;
            left: 30%;
            width: 40vw;
            height: 40vw;
            background: #c7d2fe;
            /* Indigo 200 */
            animation-delay: 2s;
        }

        @keyframes float {
            0% {
                transform: translate(0, 0) scale(1);
            }

            100% {
                transform: translate(20px, -20px) scale(1.05);
            }
        }

        /* DISEÑO DE HEADER - Light Glass */
        .glass-header {
            background: rgba(248, 250, 252, 0.9);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        /* DISEÑO DE CARDS - Light mode */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid #e2e8f0;
            box-shadow: 0 10px 40px -15px rgba(0, 0, 0, 0.1);
        }

        /* UTILIDADES */
        .btn-brand {
            background: linear-gradient(135deg, #0d9488 0%, #4f46e5 100%);
            transition: all 0.3s ease;
            color: white;
        }

        .btn-brand:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -10px rgba(79, 70, 229, 0.4);
        }

        .role-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
            background: white;
        }

        .role-card:hover {
            background: #f0fdfa;
            border-color: #14b8a6;
            transform: translateY(-4px);
            box-shadow: 0 10px 30px -10px rgba(20, 184, 166, 0.3);
        }

        .strategy-btn {
            transition: all 0.3s ease;
            background: white;
            border: 2px solid #e2e8f0;
            color: #334155;
        }

        .strategy-btn:hover {
            transform: translateY(-2px);
            border-color: #14b8a6;
            background: #f0fdfa;
        }

        /* ANIMACIONES */
        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* LOGO FALLBACK */
        #fallback-logo {
            display: none;
        }

        /* LIGHT MODE OVERRIDES - Force light colors on dark Tailwind classes */

        /* Text color overrides */
        .text-white {
            color: #1e293b !important;
        }

        .text-cyan-200,
        .text-cyan-300 {
            color: #0891b2 !important;
        }

        .text-cyan-400 {
            color: #0d9488 !important;
        }

        .text-slate-200,
        .text-slate-300 {
            color: #475569 !important;
        }

        .text-slate-400 {
            color: #64748b !important;
        }

        .text-indigo-300 {
            color: #4f46e5 !important;
        }

        /* Background overrides using attribute selectors for Tailwind opacity classes */
        [class*="bg-slate-900"],
        [class*="bg-slate-950"] {
            background: linear-gradient(135deg, #f0fdfa 0%, #ecfeff 100%) !important;
            border: 1px solid #99f6e4 !important;
        }

        [class*="bg-slate-800"] {
            background-color: white !important;
            border: 1px solid #e2e8f0 !important;
            box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.08) !important;
        }

        [class*="bg-slate-700"] {
            background-color: #f1f5f9 !important;
        }

        [class*="bg-cyan-900"] {
            background-color: rgba(204, 251, 241, 0.6) !important;
        }

        [class*="bg-indigo-900"] {
            background-color: rgba(224, 231, 255, 0.5) !important;
        }

        /* Gradient overrides */
        [class*="from-indigo-500"],
        [class*="to-cyan-500"] {
            background: linear-gradient(135deg, rgba(204, 251, 241, 0.5) 0%, rgba(224, 231, 255, 0.5) 100%) !important;
        }

        [class*="from-indigo-900"],
        [class*="to-slate-900"] {
            background: linear-gradient(135deg, #f0fdfa 0%, #ecfeff 100%) !important;
        }

        /* Border overrides */
        [class*="border-white"] {
            border-color: #e2e8f0 !important;
        }

        [class*="border-cyan-500"] {
            border-color: #14b8a6 !important;
        }

        /* Success/Error result colors - vibrant versions */
        [class*="bg-emerald-900"] {
            background-color: rgba(209, 250, 229, 0.7) !important;
            border: 1px solid #6ee7b7 !important;
        }

        [class*="bg-rose-900"] {
            background-color: rgba(255, 228, 230, 0.7) !important;
            border: 1px solid #fda4af !important;
        }

        .text-emerald-400 {
            color: #059669 !important;
        }

        .text-rose-400 {
            color: #e11d48 !important;
        }

        [class*="border-emerald-500"] {
            border-color: #10b981 !important;
        }

        [class*="border-rose-500"] {
            border-color: #f43f5e !important;
        }

        /* BTN Brand - Keep white text */
        .btn-brand,
        .btn-brand * {
            color: white !important;
        }

        /* Large icon in glossary card */
        [class*="text-slate-500"] i,
        i[class*="text-slate-500"] {
            color: #14b8a6 !important;
            opacity: 0.3;
        }

        /* Dots progress indicator */
        .bg-slate-600 {
            background-color: #cbd5e1 !important;
        }

        /* Quote box special styling */
        .border-l-4.border-cyan-500 {
            background: linear-gradient(135deg, #f0fdfa 0%, #ecfeff 100%) !important;
            border-left: 4px solid #14b8a6 !important;
        }

        /* Shadow fix for icon circle */
        [class*="shadow-\\[0_0_40px"] {
            box-shadow: 0 0 40px rgba(20, 184, 166, 0.2) !important;
        }
    </style>
</head>

<body>

    <div class="aurora-blob blob-1"></div>
    <div class="aurora-blob blob-2"></div>
    <div class="aurora-blob blob-3"></div>

    <!-- CONTENEDOR PRINCIPAL (optimizado para iframe) -->
    <main id="app" class="relative z-10 w-full h-full flex items-center justify-center px-4 py-4 overflow-y-auto">
        <!-- JS Inject -->
    </main>

    <!-- LÓGICA -->
    <script>
        // --- 1. DEFINICIONES GENERALES (TEORÍA JULIA) ---
        const generalConcepts = {
            prompt: {
                title: "1. EL PROMPT",
                subtitle: "(La Instrucción)",
                icon: "terminal-square",
                def: "Es el punto de partida. La llave que activa la inteligencia. No es hablar por hablar, es saber pedir.",
                analogy: "La Receta del Chef: Si solo dices 'tengo hambre', te dará cualquier cosa. Si das la receta exacta, el plato será perfecto."
            },
            llm: {
                title: "2. LLM",
                subtitle: "(El Cerebro)",
                icon: "brain-circuit",
                def: "Large Language Model. Un sistema de probabilidades que ha leído casi todo internet. No piensa, predice.",
                analogy: "Una Biblioteca Infinita: Todos los libros están conectados por hilos invisibles que la IA teje para crear tu respuesta."
            },
            tokens: {
                title: "3. TOKENS",
                subtitle: "(Las Piezas)",
                icon: "puzzle",
                def: "La unidad de medida. La IA no lee palabras, lee fragmentos. Tiene un límite de piezas para construir cada respuesta.",
                analogy: "Piezas de Lego: La IA tiene un balde limitado. Si se acaba el balde a mitad de la construcción, la respuesta se corta."
            },
            context: {
                title: "4. CONTEXTO",
                subtitle: "(La Memoria)",
                icon: "maximize",
                def: "Ventana de Contexto. Es la memoria de corto plazo. Determina cuánto puede recordar dentro de una misma conversación.",
                analogy: "La Pizarra de Oficina: Si escribes demasiado, tienes que borrar lo de arriba (el inicio) para seguir anotando abajo."
            },
            multimodal: {
                title: "5. MULTIMODALIDAD",
                subtitle: "(Los Sentidos)",
                icon: "eye",
                def: "La capacidad de procesar diferentes tipos de información simultáneamente (texto, imagen, audio).",
                analogy: "Súper Sentidos: Ahora puedes mostrarle una foto de tu refrigerador y la IA 'verá' los ingredientes."
            },
            hallucination: {
                title: "6. ALUCINACIÓN",
                subtitle: "(El Error)",
                icon: "ghost",
                def: "Cuando la IA inventa información falsa con total seguridad para completar el patrón probabilístico.",
                analogy: "El Guía Turístico Novato: No conoce el camino, pero inventa las direcciones con una sonrisa para no quedar mal frente a ti."
            }
        };

        // --- 2. BASE DE DATOS DE CASOS (AMPLIADA Y ROTATIVA) ---
        const contentDB = {
            business: {
                label: "Negocios & Ventas",
                concepts: {
                    llm: "Imagina un Consultor Senior que ha leído todos los estudios de mercado, pero nunca ha visitado a un cliente real. Sabe teoría, le falta calle.",
                    tokens: "Piensa en un Presupuesto de Campaña. Cada sílaba cuesta. Si gastas todo en la intro, no queda dinero para el cierre.",
                    context: "Como una Sala de Reuniones. Si metes a 50 personas hablando a la vez, nadie entiende. Debes limpiar la sala para cada tema.",
                    hallucination: "Un Vendedor Desesperado que inventa cifras de crecimiento solo para que el directorio le sonría.",
                    multimodal: "Tu analista tiene Ojos. Le muestras una foto de la góndola vacía y te dice qué productos reponer.",
                    prompt: "El Briefing. Si le dices a la agencia 'haz algo creativo', fallan. Si das la estrategia clara, ejecutan perfecto."
                },
                scenarios: [
                    {
                        id: 1,
                        title: "El Reporte Anual de 600 Páginas",
                        challenge: "Tienes los reportes de ventas de los últimos 5 años (PDFs gigantes). Necesitas identificar por qué cayeron las ventas en Q3 2024.",
                        optionA: { label: "Subir todos los PDFs de una vez al chat.", feedback: "Error", text: "¡Saturación! La IA olvidó los datos del 2020 y mezcló cifras porque se le acabó la 'Pizarra'." },
                        optionB: { label: "Subir solo el Q3 2024 y pedir análisis puntual.", feedback: "Acierto", text: "Perfecto. Gestionaste la memoria (Contexto) priorizando lo relevante." },
                        relatedConcept: "context"
                    },
                    {
                        id: 2,
                        title: "Correo de Venta en Frío",
                        challenge: "Quieres que la IA escriba un correo para vender tu consultoría a un Gerente General ocupado.",
                        optionA: { label: "Prompt: 'Escribe un correo para vender mis servicios'.", feedback: "Error", text: "Resultado genérico y robótico. La IA no sabe quién eres ni qué vendes." },
                        optionB: { label: "Prompt: 'Actúa como experto en B2B. Escribe un correo corto, tono directo...'", feedback: "Acierto", text: "¡Bien! Definiste el Rol (Chef) y la Receta (Prompt) con claridad." },
                        relatedConcept: "prompt"
                    },
                    {
                        id: 3,
                        title: "Datos de Mercado 2025",
                        challenge: "Necesitas saber la cuota de mercado exacta de tu competidor en Chile para una presentación urgente.",
                        optionA: { label: "Preguntar directo: '¿Cuál es la cuota de X en 2025?'", feedback: "Error", text: "¡Peligro! La IA inventó una cifra (Alucinación) para complacerte." },
                        optionB: { label: "Pedir: 'Busca en la web reportes oficiales y cita fuentes'.", feedback: "Acierto", text: "Correcto. Conectaste a internet para validar hechos reales." },
                        relatedConcept: "hallucination"
                    }
                ]
            },
            legal: {
                label: "Legal & Profesional",
                concepts: {
                    llm: "Un Paralegal rapidísimo que leyó toda la jurisprudencia, pero no tiene ética ni criterio. Requiere supervisión.",
                    tokens: "Como una Foja Judicial. Tienes un límite físico por página. Si te excedes, se pierde el hilo en la siguiente hoja.",
                    context: "El Expediente. Si es demasiado grueso, el asistente olvida la demanda inicial al leer la sentencia final.",
                    hallucination: "Un Abogado Junior citando una ley derogada con total seguridad, solo para sonar inteligente.",
                    multimodal: "Puedes subir la Foto de un Contrato firmado y la IA te alerta de las cláusulas manuscritas riesgosas.",
                    prompt: "La Instrucción Jurídica. La IA es literal: si hay ambigüedad en tu pedido, habrá error en la ejecución."
                },
                scenarios: [
                    {
                        id: 1,
                        title: "Revisión de Contrato M&A",
                        challenge: "Debes revisar un contrato de fusión de 150 páginas buscando cláusulas de 'Cambio de Control'.",
                        optionA: { label: "Pedir: 'Lee esto y dime si está bien'.", feedback: "Error", text: "Demasiado vago. La IA te dará un resumen genérico inútil." },
                        optionB: { label: "Pedir: 'Extrae textualmente las cláusulas de Cambio de Control'.", feedback: "Acierto", text: "Excelente. Limitaste la tarea a extracción literal (Prompt)." },
                        relatedConcept: "prompt"
                    },
                    {
                        id: 2,
                        title: "Jurisprudencia Reciente",
                        challenge: "Necesitas citar 3 fallos de la Corte Suprema sobre 'Despido Injustificado' de este año.",
                        optionA: { label: "Pedir: 'Dame 3 fallos recientes'.", feedback: "Error", text: "¡Alerta! La IA inventó roles y fechas (Alucinación) que parecen reales pero no existen." },
                        optionB: { label: "Pedir: 'Busca en el poder judicial y dame el link'.", feedback: "Acierto", text: "Bien. No confiaste en su memoria, pediste evidencia (Validación)." },
                        relatedConcept: "hallucination"
                    },
                    {
                        id: 3,
                        title: "Resumen de Expediente",
                        challenge: "Tienes un juicio de 5 años con miles de fojas. Quieres un resumen cronológico.",
                        optionA: { label: "Copiar y pegar todo el texto del juicio.", feedback: "Error", text: "La IA colapsó. El 'balde de piezas' (Tokens) se acabó a la mitad." },
                        optionB: { label: "Subir por etapas (Año 1, Año 2...) y pedir resúmenes parciales.", feedback: "Acierto", text: "Estratega. Gestionaste el Contexto dividiendo el problema." },
                        relatedConcept: "tokens"
                    }
                ]
            },
            admin: {
                label: "Gestión & Adm.",
                concepts: {
                    llm: "Un Asistente Ejecutivo incansable que redacta perfecto, pero no conoce la cultura de tu empresa ni a tus jefes.",
                    tokens: "Un Post-it. No puedes escribir la historia de tu vida ahí, tienes que ser breve para que quepa lo importante.",
                    context: "Tu Bandeja de Entrada. Si intentas leer 500 correos a la vez, colapsas. Tienes que procesar por lotes.",
                    hallucination: "Un Pasante que rellena una celda de Excel con un número inventado porque no encontró la factura real.",
                    multimodal: "Le subes la Foto de una Factura arrugada y la pasa a una tabla de Excel limpia automáticamente.",
                    prompt: "El Procedimiento (SOP). Si le dices 'ordena esto', lo hará mal. Si le das el paso a paso, será perfecto."
                },
                scenarios: [
                    {
                        id: 1,
                        title: "Digitalizar Facturas",
                        challenge: "Tienes 50 facturas en fotos desordenadas y necesitas pasarlas a una tabla Excel.",
                        optionA: { label: "Subir las 50 fotos juntas y pedir 'Haz la tabla'.", feedback: "Error", text: "Caos. La IA alucinó montos y mezcló proveedores por sobrecarga." },
                        optionB: { label: "Subir de a 5 y pedir 'Extrae RUT y Monto'.", feedback: "Acierto", text: "Correcto. Usaste la Multimodalidad con control y orden." },
                        relatedConcept: "multimodal"
                    },
                    {
                        id: 2,
                        title: "Acta de Reunión",
                        challenge: "Tienes la grabación de una reunión de 3 horas donde todos hablaron a la vez.",
                        optionA: { label: "Pedir: 'Transcribe todo literal'.", feedback: "Error", text: "Se acabaron los Tokens. El texto era demasiado largo para una sola respuesta." },
                        optionB: { label: "Pedir: 'Resume los acuerdos y tareas por persona'.", feedback: "Acierto", text: "Bien. Pediste síntesis (Prompt), ahorrando 'piezas de Lego'." },
                        relatedConcept: "tokens"
                    },
                    {
                        id: 3,
                        title: "Correo de Cobranza",
                        challenge: "Debes cobrarle suavemente a un cliente importante que se atrasó.",
                        optionA: { label: "Prompt: 'Escribe un correo de cobranza'.", feedback: "Error", text: "Salió agresivo y seco. La IA no conoce la relación con el cliente." },
                        optionB: { label: "Prompt: 'Actúa como asistente amable. El cliente es amigo...'", feedback: "Acierto", text: "Perfecto. El Tono (Prompt) ajustó la respuesta a la realidad." },
                        relatedConcept: "llm"
                    }
                ]
            },
            education: {
                label: "Educación",
                concepts: {
                    llm: "Un Bibliotecario que memorizó todos los libros, pero nunca dio una clase. Sabe el dato, no la pedagogía.",
                    tokens: "El Límite de Palabras en un ensayo. Si gastas todo en la introducción, no hay conclusión.",
                    context: "La Pizarra. Si la llenas de texto y sigues escribiendo, tienes que borrar lo que explicaste al inicio.",
                    hallucination: "Ese Alumno que inventa una respuesta con total seguridad para no quedarse callado.",
                    multimodal: "La IA tiene ojos: subes la Foto de un Ejercicio a mano y te explica cómo resolverlo.",
                    prompt: "La Rúbrica. Si la instrucción del examen es vaga, la respuesta del alumno será vaga."
                },
                scenarios: [
                    {
                        id: 1,
                        title: "Planificación Anual",
                        challenge: "Quieres planificar todo el año escolar de Historia (marzo a diciembre) con detalle día a día.",
                        optionA: { label: "Pedir: 'Haz la planificación completa ahora'.", feedback: "Error", text: "Imposible. La IA perdió el detalle a mitad de año (Contexto)." },
                        optionB: { label: "Pedir: 'Planifica solo la Unidad 1 con objetivos'.", feedback: "Acierto", text: "Bien. Segmentar es la clave para mantener la calidad." },
                        relatedConcept: "context"
                    },
                    {
                        id: 2,
                        title: "Bibliografía para Tesis",
                        challenge: "Un alumno pide ayuda para encontrar papers académicos sobre un tema muy específico.",
                        optionA: { label: "Preguntar a la IA por '5 papers clave'.", feedback: "Error", text: "Inventó títulos y autores (Alucinación) que suenan reales pero no existen." },
                        optionB: { label: "Usar una IA con acceso a bases académicas reales.", feedback: "Acierto", text: "Correcto. Entendiste que el LLM base no es una base de datos confiable." },
                        relatedConcept: "hallucination"
                    },
                    {
                        id: 3,
                        title: "Feedback a Alumnos",
                        challenge: "Quieres corregir 30 ensayos dándole feedback personalizado a cada uno.",
                        optionA: { label: "Pegar los 30 ensayos juntos.", feedback: "Error", text: "Mezcló los nombres y comentarios de los alumnos. Pizarra llena." },
                        optionB: { label: "Pegar uno a uno junto con la Rúbrica.", feedback: "Acierto", text: "Excelente. Rúbrica (Prompt) + Un caso a la vez = Calidad." },
                        relatedConcept: "prompt"
                    }
                ]
            }
        };

        // --- 3. ESTADO ---
        // Mapeo de nombres de segmento del Campus a IDs internos del glosario
        const campusToGlosarioMap = {
            'Negocios & Ventas': 'business',
            'Legal & Profesional': 'legal',
            'Gestión & Administración': 'admin',
            'Educación & Capacitación': 'education'
        };

        // Leer segmento del Campus (si existe)
        const campusSegment = localStorage.getItem('userSegment');
        const mappedSegment = campusSegment ? campusToGlosarioMap[campusSegment] : null;

        const state = {
            step: mappedSegment ? 0 : 0, // Si hay segmento, igual empezamos en intro
            selectedSegment: mappedSegment || null, // Pre-cargar segmento del Campus
            activeCard: 0, // Para navegar las 6 tarjetas del glosario
            simResult: null,
            currentScenario: null
        };

        // --- 4. RENDER ---
        const app = document.getElementById('app');

        function render() {
            app.innerHTML = '';

            const card = document.createElement('div');
            const widthClass = state.step === 2 ? 'max-w-6xl' : 'max-w-4xl';
            card.className = `glass-card rounded-2xl p-6 md:p-12 w-full ${widthClass} transition-all duration-700 opacity-0 transform translate-y-4 mx-auto`;

            setTimeout(() => card.classList.remove('opacity-0', 'translate-y-4'), 50);

            let content = '';
            switch (state.step) {
                case 0: content = renderActivation(); break;
                case 1: content = renderSegmentation(); break;
                case 2: content = renderGlossary(); break;
                case 3: content = renderSimulator(); break;
                case 4: content = renderConclusion(); break;
            }

            card.innerHTML = content;
            app.appendChild(card);
            lucide.createIcons();

            const badge = document.getElementById('segment-badge');
            if (state.selectedSegment && badge) {
                badge.innerText = contentDB[state.selectedSegment].label;
                badge.classList.remove('hidden');
            }
        }

        // --- VISTAS ---

        function renderActivation() {
            return `
                <div class="text-center space-y-8 py-4 fade-in">
                    <div class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-gradient-to-br from-indigo-500/20 to-cyan-500/20 text-cyan-300 mb-2 border border-white/10 shadow-[0_0_40px_rgba(6,182,212,0.2)]">
                        <i data-lucide="book-open-check" class="w-10 h-10 animate-pulse"></i>
                    </div>
                    <div class="space-y-4">
                        <h1 class="text-3xl md:text-5xl font-extrabold tracking-tight text-white drop-shadow-lg leading-tight">
                            Glosario Interactivo Aplicado
                        </h1>
                        <p class="text-lg md:text-xl font-light text-cyan-200">
                            Entiende la herramienta. Domina la estrategia.
                        </p>
                    </div>
                    <div class="bg-slate-900/50 p-6 rounded-xl border-l-4 border-cyan-500 max-w-2xl mx-auto text-left relative overflow-hidden">
                        <p class="text-slate-300 italic leading-relaxed text-lg relative z-10">
                            "Para dar órdenes de mando, primero debes entender cómo piensa tu copiloto. Aquí aprenderás los 6 pilares clave y luego pondrás a prueba tu criterio."
                        </p>
                        <p class="text-cyan-400 font-bold mt-4 text-sm uppercase tracking-widest text-right">— Julia, Aula GenIA</p>
                    </div>
                    <button onclick="nextStep()" class="btn-brand mt-8 px-10 py-4 text-white rounded-xl font-bold text-lg shadow-xl flex items-center gap-3 mx-auto group">
                        Iniciar Glosario
                        <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                    </button>
                </div>
            `;
        }

        function renderSegmentation() {
            return `
                <div class="space-y-8 fade-in text-center">
                    <div class="space-y-2">
                        <h2 class="text-3xl md:text-4xl font-bold text-white">Personalicemos tu Glosario</h2>
                        <p class="text-slate-300">Selecciona tu área para adaptar las analogías y casos prácticos.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-8">
                        ${renderRoleCard('business', 'briefcase', 'Negocios & Ventas', 'Marketing, Consultoría.')}
                        ${renderRoleCard('legal', 'scale', 'Legal & Profesional', 'Abogados, Auditores.')}
                        ${renderRoleCard('admin', 'clipboard-list', 'Gestión & Adm.', 'Operaciones, RRHH.')}
                        ${renderRoleCard('education', 'graduation-cap', 'Educación', 'Docentes, Capacitación.')}
                    </div>
                </div>
            `;
        }

        function renderRoleCard(id, icon, title, desc) {
            return `
                <div class="role-card bg-slate-800/40 p-6 rounded-xl text-left space-y-3 group" onclick="selectSegment('${id}')">
                    <div class="w-12 h-12 rounded-lg bg-slate-700/50 text-cyan-400 flex items-center justify-center border border-white/10 group-hover:bg-cyan-900/30">
                        <i data-lucide="${icon}" class="w-6 h-6"></i>
                    </div>
                    <h3 class="text-lg font-bold text-white group-hover:text-cyan-300 transition-colors">${title}</h3>
                    <p class="text-xs text-slate-400">${desc}</p>
                </div>
            `;
        }

        function renderGlossary() {
            const segment = contentDB[state.selectedSegment];
            const keys = ['prompt', 'llm', 'tokens', 'context', 'multimodal', 'hallucination'];
            const key = keys[state.activeCard];
            const general = generalConcepts[key];
            const profiled = segment.concepts[key];
            const dots = keys.map((_, idx) => `
                <div class="h-1.5 rounded-full transition-all duration-500 ${idx === state.activeCard ? 'w-8 bg-cyan-400' : 'w-2 bg-slate-600'}"></div>
            `).join('');

            return `
                <div class="grid lg:grid-cols-2 gap-12 items-center min-h-[500px] fade-in">
                    <div class="space-y-6 order-2 lg:order-1">
                        <div class="flex items-center gap-3 text-cyan-400 font-bold uppercase tracking-widest text-xs border-b border-white/10 pb-4 w-fit">
                            <span class="px-2 py-1 bg-cyan-900/30 rounded border border-cyan-500/30">Pilar 0${state.activeCard + 1}</span>
                            <span>Fundamentos</span>
                        </div>
                        <div>
                            <h2 class="text-4xl font-bold text-white tracking-tight">${general.title}</h2>
                            <p class="text-xl text-slate-400 font-light">${general.subtitle}</p>
                        </div>
                        <div class="space-y-2">
                            <p class="text-lg text-white leading-relaxed font-medium">"${general.def}"</p>
                            <div class="flex items-center gap-2 text-sm text-indigo-300 italic">
                                <i data-lucide="lightbulb" class="w-4 h-4"></i>
                                <span>Analogía Base: ${general.analogy}</span>
                            </div>
                        </div>
                        <div class="bg-slate-800/50 border-l-4 border-cyan-500 p-6 rounded-r-xl shadow-lg mt-6">
                            <h4 class="text-xs font-bold text-cyan-500 uppercase tracking-wider mb-2">En tu mundo (${segment.label}):</h4>
                            <p class="text-lg text-slate-200 font-light leading-relaxed">"${profiled}"</p>
                        </div>
                        <div class="flex gap-2 pt-6">${dots}</div>
                    </div>
                    <div class="order-1 lg:order-2 relative h-full min-h-[250px] lg:min-h-[450px] bg-gradient-to-br from-indigo-900/40 to-slate-900/40 rounded-2xl border border-white/10 flex items-center justify-center group overflow-hidden shadow-inner">
                        <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4wNSkiLz48L3N2Zz4=')] opacity-30"></div>
                        <i data-lucide="${general.icon}" class="w-40 h-40 text-slate-500/30 group-hover:text-cyan-400/80 group-hover:scale-110 transition-all duration-700 filter drop-shadow-[0_0_30px_rgba(6,182,212,0.1)]"></i>
                    </div>
                </div>
                <div class="flex justify-between mt-10 pt-8 border-t border-white/5">
                    <button onclick="prevCard()" class="btn-outline px-6 py-2 rounded-lg text-slate-300 hover:text-white text-sm font-medium flex items-center gap-2 ${state.activeCard === 0 ? 'invisible' : ''}">
                        <i data-lucide="chevron-left" class="w-4 h-4"></i> Anterior
                    </button>
                    <button onclick="nextCard()" class="btn-brand px-8 py-3 text-white rounded-lg font-bold shadow-lg flex items-center gap-2 hover:translate-x-1 transition-transform">
                        ${state.activeCard === 5 ? 'Ir a la Práctica' : 'Siguiente'} <i data-lucide="${state.activeCard === 5 ? 'swords' : 'arrow-right'}" class="w-4 h-4"></i>
                    </button>
                </div>
            `;
        }

        // --- LÓGICA DE SIMULADOR DINÁMICO ---
        // Lógica corregida para rotación circular
        function loadNextCase() {
            const segmentData = contentDB[state.selectedSegment];

            // Buscar índice actual
            let currentIndex = -1;
            if (state.currentScenario) {
                currentIndex = segmentData.scenarios.findIndex(s => s.id === state.currentScenario.id);
            }

            // Calcular siguiente índice circular
            let nextIndex = (currentIndex + 1) % segmentData.scenarios.length;

            state.currentScenario = segmentData.scenarios[nextIndex];
            state.simResult = null;

            render();
        }

        function renderSimulator() {
            // Inicializar el primer caso si no existe
            if (!state.currentScenario) {
                // Empezamos siempre por el primero para orden, o random si prefieres
                // Para consistencia en primer uso, mejor el primero
                state.currentScenario = contentDB[state.selectedSegment].scenarios[0];
            }

            const sim = state.currentScenario;
            const relatedKey = sim.relatedConcept;
            const generalConcept = generalConcepts[relatedKey];

            if (state.simResult) {
                const isSuccess = state.simResult === 'success';
                const resultData = isSuccess ? sim.optionB : sim.optionA;
                const color = isSuccess ? 'emerald' : 'rose';
                const icon = isSuccess ? 'check-circle-2' : 'alert-circle';

                return `
                    <div class="space-y-8 fade-in text-center max-w-3xl mx-auto">
                        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-${color}-900/30 text-${color}-400 border border-${color}-500/30 font-bold uppercase text-sm tracking-widest mb-2">
                            <i data-lucide="${icon}" class="w-4 h-4"></i>
                            ${isSuccess ? '¡Criterio Estratégico!' : 'Diagnóstico: Error de Concepto'}
                        </div>
                        
                        <div class="bg-slate-950/50 p-8 rounded-2xl border border-${color}-500/30 shadow-xl relative overflow-hidden">
                            <p class="text-2xl text-white font-medium relative z-10 mb-6">
                                "${resultData.text}"
                            </p>

                            <div class="bg-slate-800/60 rounded-xl p-6 text-left relative z-10 border border-white/10">
                                <div class="flex items-start gap-4">
                                    <div class="p-3 bg-cyan-900/30 rounded-lg text-cyan-400 hidden md:block">
                                        <i data-lucide="${generalConcept.icon}" class="w-6 h-6"></i>
                                    </div>
                                    <div class="space-y-2">
                                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-widest">
                                            Repasa el concepto: <span class="text-cyan-400">${generalConcept.title}</span>
                                        </h4>
                                        <p class="text-slate-300 text-sm leading-relaxed">
                                            Recuerda: ${generalConcept.def}
                                        </p>
                                        <p class="text-white text-sm font-medium mt-3 pt-3 border-t border-white/5">
                                            <span class="text-${color}-400 font-bold">Diagnóstico:</span> 
                                            ${isSuccess
                        ? "Aplicaste bien el criterio. Entendiste el límite técnico y ajustaste tu estrategia."
                        : "Fallaste porque ignoraste este pilar. Sobrecargaste al modelo o fuiste ambiguo."}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-center pt-4 gap-4">
                            ${!isSuccess ? `<button onclick="resetSimulator()" class="btn-outline px-8 py-3 rounded-full text-slate-300 hover:text-white transition-all">Intentar de nuevo</button>` : ''}
                            ${isSuccess ?
                        `<button onclick="loadNextCase()" class="btn-outline px-8 py-3 rounded-full text-cyan-300 hover:text-white border-cyan-500/50 hover:bg-cyan-900/20 transition-all flex items-center gap-2">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i> Analizar Otro Caso
                                 </button>
                                 <button onclick="finishModule()" class="btn-brand px-10 py-3 text-white rounded-full font-bold shadow-lg animate-pulse">Finalizar Módulo</button>`
                        : ''}
                        </div>
                    </div>
                `;
            }

            return `
                <div class="space-y-8 fade-in">
                    <div class="text-center space-y-4">
                        <div class="inline-block px-3 py-1 rounded-full bg-cyan-900/30 border border-cyan-500/30 text-cyan-300 text-xs font-bold uppercase tracking-widest">
                            Clínica Práctica
                        </div>
                        <h2 class="text-3xl font-bold text-white">Caso: ${sim.title}</h2>
                        <p class="text-slate-300 max-w-2xl mx-auto text-lg leading-relaxed">
                            <span class="text-white font-medium">Situación:</span> ${sim.challenge}
                            <br><br>
                            ¿Qué instrucción estratégica le das a tu Copiloto?
                        </p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto mt-8">
                        <button onclick="evaluateStrategy('fail')" class="strategy-btn group relative bg-slate-800/40 hover:bg-slate-800/80 p-8 rounded-2xl border border-white/10 text-left flex flex-col gap-4">
                            <div class="w-10 h-10 rounded-full bg-slate-700/50 text-slate-400 flex items-center justify-center border border-white/5 group-hover:border-rose-500/50 group-hover:text-rose-400 transition-colors">
                                <span class="font-bold">A</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white mb-2">Estrategia Directa</h3>
                                <p class="text-slate-300 text-sm leading-relaxed group-hover:text-white transition-colors">${sim.optionA.label}</p>
                            </div>
                        </button>

                        <button onclick="evaluateStrategy('success')" class="strategy-btn group relative bg-slate-800/40 hover:bg-slate-800/80 p-8 rounded-2xl border border-white/10 text-left flex flex-col gap-4">
                            <div class="w-10 h-10 rounded-full bg-slate-700/50 text-slate-400 flex items-center justify-center border border-white/5 group-hover:border-emerald-500/50 group-hover:text-emerald-400 transition-colors">
                                <span class="font-bold">B</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white mb-2">Estrategia Estructurada</h3>
                                <p class="text-slate-300 text-sm leading-relaxed group-hover:text-white transition-colors">${sim.optionB.label}</p>
                            </div>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderConclusion() {
            return `
                <div class="text-center space-y-10 py-6 fade-in">
                    <div class="space-y-4 border-b border-white/10 pb-8">
                        <div class="inline-block px-4 py-1 rounded-full bg-indigo-900/50 border border-indigo-500/30 text-indigo-300 text-xs font-bold uppercase tracking-widest mb-4">
                            Regla de Oro
                        </div>
                        <h2 class="text-2xl md:text-4xl font-bold text-white leading-snug max-w-3xl mx-auto">
                            "La IA es tu copiloto, no tu oráculo.<br>
                            Ella pone la potencia, pero <span class="text-cyan-400">tú pones el criterio</span>."
                        </h2>
                    </div>
                    
                    <div class="max-w-2xl mx-auto bg-slate-900/50 p-8 rounded-xl border border-white/5 text-left space-y-4 shadow-xl">
                        <div class="flex gap-4 items-start">
                            <div class="bg-cyan-900/20 p-3 rounded-lg h-fit text-cyan-400">
                                <i data-lucide="shield-question" class="w-8 h-8"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-white text-lg md:text-xl">El Desafío Final</h3>
                                <p class="text-slate-300 mt-2 leading-relaxed">
                                    No importa tu cargo. Si dudas de algo, desafía la seguridad de la IA preguntando:
                                </p>
                                <p class="text-white font-mono bg-black/30 p-4 mt-3 rounded-lg border-l-4 border-cyan-500 text-base md:text-lg">
                                    "¿Estás 100% seguro de esta respuesta?"
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="pt-6 max-w-xl mx-auto">
                        <p class="text-lg md:text-xl font-medium italic text-indigo-200 leading-relaxed">
                            "¡Nos vemos muy pronto... y recuerda: en Aula GenIA, la IA no es el futuro... 
                            <span class="block text-white font-bold text-2xl mt-2 not-italic bg-clip-text text-transparent bg-gradient-to-r from-cyan-300 to-indigo-300">TÚ lo eres!"</span>
                        </p>
                    </div>

                    <button onclick="location.reload()" class="btn-outline px-6 py-2 rounded-full text-slate-400 text-sm hover:text-white mt-8">
                        Volver al inicio
                    </button>
                </div>
            `;
        }

        // --- FUNCIONES DE CONTROL ---

        function nextStep() {
            state.step++;
            // Si estamos en paso 1 (selección) pero ya hay segmento pre-cargado del Campus, saltar al paso 2
            if (state.step === 1 && state.selectedSegment) {
                state.step = 2; // Saltar selección, ir directo al glosario
            }
            // Al entrar al simulador, nos aseguramos de limpiar el estado para empezar fresco
            if (state.step === 3) {
                state.currentScenario = null;
                state.simResult = null;
            }
            render();
        }

        function selectSegment(id) {
            state.selectedSegment = id;
            state.activeCard = 0; // Reset glossary
            nextStep();
        }

        function nextCard() {
            if (state.activeCard < 5) {
                state.activeCard++;
                render();
            } else {
                nextStep(); // Ir al simulador
            }
        }

        function prevCard() {
            if (state.activeCard > 0) {
                state.activeCard--;
                render();
            }
        }

        function evaluateStrategy(result) {
            state.simResult = result;
            if (result === 'success') {
                confetti({
                    particleCount: 150,
                    spread: 80,
                    origin: { y: 0.6 },
                    colors: ['#22d3ee', '#4f46e5', '#ffffff']
                });
            }
            render();
        }

        function resetSimulator() {
            state.simResult = null;
            // Mantiene el mismo caso para reintentar
            render();
        }

        function finishModule() {
            state.step = 4;
            render();
        }

        // Inicializar
        render();

    </script>
</body>

</html>